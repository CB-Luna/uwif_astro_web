import{T as Qs,a as Ks,b as Ys,u as et,M as hn,c as Js,_ as mr,d as gr,I as ea,S as qe,D as $t,R as An,e as Sr,H as $e,F as _t,f as Mt,L as dt,g as ui,h as ta,i as na,j as ia,C as ra,E as sa,k as aa,l as qn,W as oa,m as _r,n as la,o as xr,p as Le,N as It,B as Pt,U as xt,q as ua,r as yr,V as ye,s as ca,t as fa,v as ha,w as da,x as dn,y as va,z as ci,A as q,G as pa,J as vt,P as ma,K as Er,O as wr,Q as br,X as ga,Y as Sa,Z as vn,$ as Fi,a0 as _a,a1 as K,a2 as Tr,a3 as Mr,a4 as xa,a5 as ya,a6 as Ea,a7 as wa}from"./leva.esm.795f758f.js";import{r as D,R as Xn}from"./index.55e859f2.js";let fi=an();const $=e=>sn(e,fi);let hi=an();$.write=e=>sn(e,hi);let In=an();$.onStart=e=>sn(e,In);let di=an();$.onFrame=e=>sn(e,di);let vi=an();$.onFinish=e=>sn(e,vi);let Rt=[];$.setTimeout=(e,t)=>{let n=$.now()+t,i=()=>{let o=Rt.findIndex(l=>l.cancel==i);~o&&Rt.splice(o,1),ut-=~o?1:0},s={time:n,handler:e,cancel:i};return Rt.splice(Rr(n),0,s),ut+=1,Ar(),s};let Rr=e=>~(~Rt.findIndex(t=>t.time>e)||~Rt.length);$.cancel=e=>{In.delete(e),di.delete(e),vi.delete(e),fi.delete(e),hi.delete(e)};$.sync=e=>{Qn=!0,$.batchedUpdates(e),Qn=!1};$.throttle=e=>{let t;function n(){try{e(...t)}finally{t=null}}function i(...s){t=s,$.onStart(n)}return i.handler=e,i.cancel=()=>{In.delete(n),t=null},i};let pi=typeof window<"u"?window.requestAnimationFrame:()=>{};$.use=e=>pi=e;$.now=typeof performance<"u"?()=>performance.now():Date.now;$.batchedUpdates=e=>e();$.catch=console.error;$.frameLoop="always";$.advance=()=>{$.frameLoop!=="demand"?console.warn("Cannot call the manual advancement of rafz whilst frameLoop is not set as demand"):Ur()};let lt=-1,ut=0,Qn=!1;function sn(e,t){Qn?(t.delete(e),e(0)):(t.add(e),Ar())}function Ar(){lt<0&&(lt=0,$.frameLoop!=="demand"&&pi(Ir))}function ba(){lt=-1}function Ir(){~lt&&(pi(Ir),$.batchedUpdates(Ur))}function Ur(){let e=lt;lt=$.now();let t=Rr(lt);if(t&&(Cr(Rt.splice(0,t),n=>n.handler()),ut-=t),!ut){ba();return}In.flush(),fi.flush(e?Math.min(64,lt-e):16.667),di.flush(),hi.flush(),vi.flush()}function an(){let e=new Set,t=e;return{add(n){ut+=t==e&&!e.has(n)?1:0,e.add(n)},delete(n){return ut-=t==e&&e.has(n)?1:0,e.delete(n)},flush(n){t.size&&(e=new Set,ut-=t.size,Cr(t,i=>i(n)&&e.add(i)),ut+=e.size,t=e)}}}function Cr(e,t){e.forEach(n=>{try{t(n)}catch(i){$.catch(i)}})}function Kn(){}const Ta=(e,t,n)=>Object.defineProperty(e,t,{value:n,writable:!0,configurable:!0}),R={arr:Array.isArray,obj:e=>!!e&&e.constructor.name==="Object",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",und:e=>e===void 0};function Je(e,t){if(R.arr(e)){if(!R.arr(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}return e===t}const ee=(e,t)=>e.forEach(t);function tt(e,t,n){if(R.arr(e)){for(let i=0;i<e.length;i++)t.call(n,e[i],`${i}`);return}for(const i in e)e.hasOwnProperty(i)&&t.call(n,e[i],i)}const ze=e=>R.und(e)?[]:R.arr(e)?e:[e];function qt(e,t){if(e.size){const n=Array.from(e);e.clear(),ee(n,t)}}const jt=(e,...t)=>qt(e,n=>n(...t)),mi=()=>typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent);let gi,Br,ft=null,Pr=!1,Si=Kn;const Ma=e=>{e.to&&(Br=e.to),e.now&&($.now=e.now),e.colors!==void 0&&(ft=e.colors),e.skipAnimation!=null&&(Pr=e.skipAnimation),e.createStringInterpolator&&(gi=e.createStringInterpolator),e.requestAnimationFrame&&$.use(e.requestAnimationFrame),e.batchedUpdates&&($.batchedUpdates=e.batchedUpdates),e.willAdvance&&(Si=e.willAdvance),e.frameLoop&&($.frameLoop=e.frameLoop)};var je=Object.freeze({__proto__:null,get createStringInterpolator(){return gi},get to(){return Br},get colors(){return ft},get skipAnimation(){return Pr},get willAdvance(){return Si},assign:Ma});const Xt=new Set;let Oe=[],Ln=[],xn=0;const Un={get idle(){return!Xt.size&&!Oe.length},start(e){xn>e.priority?(Xt.add(e),$.onStart(Ra)):(Dr(e),$(Yn))},advance:Yn,sort(e){if(xn)$.onFrame(()=>Un.sort(e));else{const t=Oe.indexOf(e);~t&&(Oe.splice(t,1),Or(e))}},clear(){Oe=[],Xt.clear()}};function Ra(){Xt.forEach(Dr),Xt.clear(),$(Yn)}function Dr(e){Oe.includes(e)||Or(e)}function Or(e){Oe.splice(Aa(Oe,t=>t.priority>e.priority),0,e)}function Yn(e){const t=Ln;for(let n=0;n<Oe.length;n++){const i=Oe[n];xn=i.priority,i.idle||(Si(i),i.advance(e),i.idle||t.push(i))}return xn=0,Ln=Oe,Ln.length=0,Oe=t,Oe.length>0}function Aa(e,t){const n=e.findIndex(t);return n<0?e.length:n}const Ia=(e,t,n)=>Math.min(Math.max(n,e),t),Ua={transparent:0,aliceblue:4042850303,antiquewhite:4209760255,aqua:16777215,aquamarine:2147472639,azure:4043309055,beige:4126530815,bisque:4293182719,black:255,blanchedalmond:4293643775,blue:65535,blueviolet:2318131967,brown:2771004159,burlywood:3736635391,burntsienna:3934150143,cadetblue:1604231423,chartreuse:2147418367,chocolate:3530104575,coral:4286533887,cornflowerblue:1687547391,cornsilk:4294499583,crimson:3692313855,cyan:16777215,darkblue:35839,darkcyan:9145343,darkgoldenrod:3095792639,darkgray:2846468607,darkgreen:6553855,darkgrey:2846468607,darkkhaki:3182914559,darkmagenta:2332068863,darkolivegreen:1433087999,darkorange:4287365375,darkorchid:2570243327,darkred:2332033279,darksalmon:3918953215,darkseagreen:2411499519,darkslateblue:1211993087,darkslategray:793726975,darkslategrey:793726975,darkturquoise:13554175,darkviolet:2483082239,deeppink:4279538687,deepskyblue:12582911,dimgray:1768516095,dimgrey:1768516095,dodgerblue:512819199,firebrick:2988581631,floralwhite:4294635775,forestgreen:579543807,fuchsia:4278255615,gainsboro:3705462015,ghostwhite:4177068031,gold:4292280575,goldenrod:3668254975,gray:2155905279,green:8388863,greenyellow:2919182335,grey:2155905279,honeydew:4043305215,hotpink:4285117695,indianred:3445382399,indigo:1258324735,ivory:4294963455,khaki:4041641215,lavender:3873897215,lavenderblush:4293981695,lawngreen:2096890111,lemonchiffon:4294626815,lightblue:2916673279,lightcoral:4034953471,lightcyan:3774873599,lightgoldenrodyellow:4210742015,lightgray:3553874943,lightgreen:2431553791,lightgrey:3553874943,lightpink:4290167295,lightsalmon:4288707327,lightseagreen:548580095,lightskyblue:2278488831,lightslategray:2005441023,lightslategrey:2005441023,lightsteelblue:2965692159,lightyellow:4294959359,lime:16711935,limegreen:852308735,linen:4210091775,magenta:4278255615,maroon:2147483903,mediumaquamarine:1724754687,mediumblue:52735,mediumorchid:3126187007,mediumpurple:2473647103,mediumseagreen:1018393087,mediumslateblue:2070474495,mediumspringgreen:16423679,mediumturquoise:1221709055,mediumvioletred:3340076543,midnightblue:421097727,mintcream:4127193855,mistyrose:4293190143,moccasin:4293178879,navajowhite:4292783615,navy:33023,oldlace:4260751103,olive:2155872511,olivedrab:1804477439,orange:4289003775,orangered:4282712319,orchid:3664828159,palegoldenrod:4008225535,palegreen:2566625535,paleturquoise:2951671551,palevioletred:3681588223,papayawhip:4293907967,peachpuff:4292524543,peru:3448061951,pink:4290825215,plum:3718307327,powderblue:2967529215,purple:2147516671,rebeccapurple:1714657791,red:4278190335,rosybrown:3163525119,royalblue:1097458175,saddlebrown:2336560127,salmon:4202722047,sandybrown:4104413439,seagreen:780883967,seashell:4294307583,sienna:2689740287,silver:3233857791,skyblue:2278484991,slateblue:1784335871,slategray:1887473919,slategrey:1887473919,snow:4294638335,springgreen:16744447,steelblue:1182971135,tan:3535047935,teal:8421631,thistle:3636451583,tomato:4284696575,turquoise:1088475391,violet:4001558271,wheat:4125012991,white:4294967295,whitesmoke:4126537215,yellow:4294902015,yellowgreen:2597139199},He="[-+]?\\d*\\.?\\d+",yn=He+"%";function Cn(...e){return"\\(\\s*("+e.join(")\\s*,\\s*(")+")\\s*\\)"}const Ca=new RegExp("rgb"+Cn(He,He,He)),Ba=new RegExp("rgba"+Cn(He,He,He,He)),Pa=new RegExp("hsl"+Cn(He,yn,yn)),Da=new RegExp("hsla"+Cn(He,yn,yn,He)),Oa=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,Na=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,za=/^#([0-9a-fA-F]{6})$/,La=/^#([0-9a-fA-F]{8})$/;function Fa(e){let t;return typeof e=="number"?e>>>0===e&&e>=0&&e<=4294967295?e:null:(t=za.exec(e))?parseInt(t[1]+"ff",16)>>>0:ft&&ft[e]!==void 0?ft[e]:(t=Ca.exec(e))?(Tt(t[1])<<24|Tt(t[2])<<16|Tt(t[3])<<8|255)>>>0:(t=Ba.exec(e))?(Tt(t[1])<<24|Tt(t[2])<<16|Tt(t[3])<<8|Gi(t[4]))>>>0:(t=Oa.exec(e))?parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+"ff",16)>>>0:(t=La.exec(e))?parseInt(t[1],16)>>>0:(t=Na.exec(e))?parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+t[4]+t[4],16)>>>0:(t=Pa.exec(e))?(ki(Hi(t[1]),pn(t[2]),pn(t[3]))|255)>>>0:(t=Da.exec(e))?(ki(Hi(t[1]),pn(t[2]),pn(t[3]))|Gi(t[4]))>>>0:null}function Fn(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<1/2?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function ki(e,t,n){const i=n<.5?n*(1+t):n+t-n*t,s=2*n-i,o=Fn(s,i,e+1/3),l=Fn(s,i,e),f=Fn(s,i,e-1/3);return Math.round(o*255)<<24|Math.round(l*255)<<16|Math.round(f*255)<<8}function Tt(e){const t=parseInt(e,10);return t<0?0:t>255?255:t}function Hi(e){return(parseFloat(e)%360+360)%360/360}function Gi(e){const t=parseFloat(e);return t<0?0:t>1?255:Math.round(t*255)}function pn(e){const t=parseFloat(e);return t<0?0:t>100?1:t/100}function Vi(e){let t=Fa(e);if(t===null)return e;t=t||0;let n=(t&4278190080)>>>24,i=(t&16711680)>>>16,s=(t&65280)>>>8,o=(t&255)/255;return`rgba(${n}, ${i}, ${s}, ${o})`}const Yt=(e,t,n)=>{if(R.fun(e))return e;if(R.arr(e))return Yt({range:e,output:t,extrapolate:n});if(R.str(e.output[0]))return gi(e);const i=e,s=i.output,o=i.range||[0,1],l=i.extrapolateLeft||i.extrapolate||"extend",f=i.extrapolateRight||i.extrapolate||"extend",c=i.easing||(h=>h);return h=>{const m=Ha(h,o);return ka(h,o[m],o[m+1],s[m],s[m+1],c,l,f,i.map)}};function ka(e,t,n,i,s,o,l,f,c){let h=c?c(e):e;if(h<t){if(l==="identity")return h;l==="clamp"&&(h=t)}if(h>n){if(f==="identity")return h;f==="clamp"&&(h=n)}return i===s?i:t===n?e<=t?i:s:(t===-1/0?h=-h:n===1/0?h=h-t:h=(h-t)/(n-t),h=o(h),i===-1/0?h=-h:s===1/0?h=h+i:h=h*(s-i)+i,h)}function Ha(e,t){for(var n=1;n<t.length-1&&!(t[n]>=e);++n);return n-1}const Ga=(e,t="end")=>n=>{n=t==="end"?Math.min(n,.999):Math.max(n,.001);const i=n*e,s=t==="end"?Math.floor(i):Math.ceil(i);return Ia(0,1,s/e)},En=1.70158,mn=En*1.525,Zi=En+1,Wi=2*Math.PI/3,$i=2*Math.PI/4.5,gn=e=>e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375,Va={linear:e=>e,easeInQuad:e=>e*e,easeOutQuad:e=>1-(1-e)*(1-e),easeInOutQuad:e=>e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2,easeInCubic:e=>e*e*e,easeOutCubic:e=>1-Math.pow(1-e,3),easeInOutCubic:e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,easeInQuart:e=>e*e*e*e,easeOutQuart:e=>1-Math.pow(1-e,4),easeInOutQuart:e=>e<.5?8*e*e*e*e:1-Math.pow(-2*e+2,4)/2,easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>1-Math.pow(1-e,5),easeInOutQuint:e=>e<.5?16*e*e*e*e*e:1-Math.pow(-2*e+2,5)/2,easeInSine:e=>1-Math.cos(e*Math.PI/2),easeOutSine:e=>Math.sin(e*Math.PI/2),easeInOutSine:e=>-(Math.cos(Math.PI*e)-1)/2,easeInExpo:e=>e===0?0:Math.pow(2,10*e-10),easeOutExpo:e=>e===1?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>e===0?0:e===1?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2,easeInCirc:e=>1-Math.sqrt(1-Math.pow(e,2)),easeOutCirc:e=>Math.sqrt(1-Math.pow(e-1,2)),easeInOutCirc:e=>e<.5?(1-Math.sqrt(1-Math.pow(2*e,2)))/2:(Math.sqrt(1-Math.pow(-2*e+2,2))+1)/2,easeInBack:e=>Zi*e*e*e-En*e*e,easeOutBack:e=>1+Zi*Math.pow(e-1,3)+En*Math.pow(e-1,2),easeInOutBack:e=>e<.5?Math.pow(2*e,2)*((mn+1)*2*e-mn)/2:(Math.pow(2*e-2,2)*((mn+1)*(e*2-2)+mn)+2)/2,easeInElastic:e=>e===0?0:e===1?1:-Math.pow(2,10*e-10)*Math.sin((e*10-10.75)*Wi),easeOutElastic:e=>e===0?0:e===1?1:Math.pow(2,-10*e)*Math.sin((e*10-.75)*Wi)+1,easeInOutElastic:e=>e===0?0:e===1?1:e<.5?-(Math.pow(2,20*e-10)*Math.sin((20*e-11.125)*$i))/2:Math.pow(2,-20*e+10)*Math.sin((20*e-11.125)*$i)/2+1,easeInBounce:e=>1-gn(1-e),easeOutBounce:gn,easeInOutBounce:e=>e<.5?(1-gn(1-2*e))/2:(1+gn(2*e-1))/2,steps:Ga};function Jn(){return Jn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Jn.apply(this,arguments)}const Ut=Symbol.for("FluidValue.get"),yt=Symbol.for("FluidValue.observers"),We=e=>!!(e&&e[Ut]),De=e=>e&&e[Ut]?e[Ut]():e,ji=e=>e[yt]||null;function Za(e,t){e.eventObserved?e.eventObserved(t):e(t)}function wn(e,t){let n=e[yt];n&&n.forEach(i=>{Za(i,t)})}class Wa{constructor(t){if(this[Ut]=void 0,this[yt]=void 0,!t&&!(t=this.get))throw Error("Unknown getter");$a(this,t)}}const $a=(e,t)=>Nr(e,Ut,t);function on(e,t){if(e[Ut]){let n=e[yt];n||Nr(e,yt,n=new Set),n.has(t)||(n.add(t),e.observerAdded&&e.observerAdded(n.size,t))}return t}function bn(e,t){let n=e[yt];if(n&&n.has(t)){const i=n.size-1;i?n.delete(t):e[yt]=null,e.observerRemoved&&e.observerRemoved(i,t)}}const Nr=(e,t,n)=>Object.defineProperty(e,t,{value:n,writable:!0,configurable:!0}),_n=/[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,ja=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d\.]+%?\))/gi,qi=new RegExp(`(${_n.source})(%|[a-z]+)`,"i"),qa=/rgba\(([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+)\)/gi,Bn=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/,zr=e=>{const[t,n]=Xa(e);if(!t||mi())return e;const i=window.getComputedStyle(document.documentElement).getPropertyValue(t);if(i)return i.trim();if(n&&n.startsWith("--")){const s=window.getComputedStyle(document.documentElement).getPropertyValue(n);return s||e}else{if(n&&Bn.test(n))return zr(n);if(n)return n}return e},Xa=e=>{const t=Bn.exec(e);if(!t)return[,];const[,n,i]=t;return[n,i]};let kn;const Qa=(e,t,n,i,s)=>`rgba(${Math.round(t)}, ${Math.round(n)}, ${Math.round(i)}, ${s})`,Lr=e=>{kn||(kn=ft?new RegExp(`(${Object.keys(ft).join("|")})(?!\\w)`,"g"):/^\b$/);const t=e.output.map(o=>De(o).replace(Bn,zr).replace(ja,Vi).replace(kn,Vi)),n=t.map(o=>o.match(_n).map(Number)),s=n[0].map((o,l)=>n.map(f=>{if(!(l in f))throw Error('The arity of each "output" value must be equal');return f[l]})).map(o=>Yt(Jn({},e,{output:o})));return o=>{var l;const f=!qi.test(t[0])&&((l=t.find(h=>qi.test(h)))==null?void 0:l.replace(_n,""));let c=0;return t[0].replace(_n,()=>`${s[c++](o)}${f||""}`).replace(qa,Qa)}},_i="react-spring: ",Fr=e=>{const t=e;let n=!1;if(typeof t!="function")throw new TypeError(`${_i}once requires a function parameter`);return(...i)=>{n||(t(...i),n=!0)}},Ka=Fr(console.warn);function Ya(){Ka(`${_i}The "interpolate" function is deprecated in v9 (use "to" instead)`)}const Ja=Fr(console.warn);function eo(){Ja(`${_i}Directly calling start instead of using the api object is deprecated in v9 (use ".start" instead), this will be removed in later 0.X.0 versions`)}function Pn(e){return R.str(e)&&(e[0]=="#"||/\d/.test(e)||!mi()&&Bn.test(e)||e in(ft||{}))}const xi=mi()?D.useEffect:D.useLayoutEffect,to=()=>{const e=D.useRef(!1);return xi(()=>(e.current=!0,()=>{e.current=!1}),[]),e};function kr(){const e=D.useState()[1],t=to();return()=>{t.current&&e(Math.random())}}function no(e,t){const[n]=D.useState(()=>({inputs:t,result:e()})),i=D.useRef(),s=i.current;let o=s;return o?t&&o.inputs&&io(t,o.inputs)||(o={inputs:t,result:e()}):o=n,D.useEffect(()=>{i.current=o,s==n&&(n.inputs=n.result=void 0)},[o]),o.result}function io(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}const Hr=e=>D.useEffect(e,ro),ro=[];function Xi(e){const t=D.useRef();return D.useEffect(()=>{t.current=e}),t.current}const Jt=Symbol.for("Animated:node"),so=e=>!!e&&e[Jt]===e,Ze=e=>e&&e[Jt],yi=(e,t)=>Ta(e,Jt,t),Dn=e=>e&&e[Jt]&&e[Jt].getPayload();class Gr{constructor(){this.payload=void 0,yi(this,this)}getPayload(){return this.payload||[]}}class Dt extends Gr{constructor(t){super(),this.done=!0,this.elapsedTime=void 0,this.lastPosition=void 0,this.lastVelocity=void 0,this.v0=void 0,this.durationProgress=0,this._value=t,R.num(this._value)&&(this.lastPosition=this._value)}static create(t){return new Dt(t)}getPayload(){return[this]}getValue(){return this._value}setValue(t,n){return R.num(t)&&(this.lastPosition=t,n&&(t=Math.round(t/n)*n,this.done&&(this.lastPosition=t))),this._value===t?!1:(this._value=t,!0)}reset(){const{done:t}=this;this.done=!1,R.num(this._value)&&(this.elapsedTime=0,this.durationProgress=0,this.lastPosition=this._value,t&&(this.lastVelocity=null),this.v0=null)}}class Ct extends Dt{constructor(t){super(0),this._string=null,this._toString=void 0,this._toString=Yt({output:[t,t]})}static create(t){return new Ct(t)}getValue(){let t=this._string;return t??(this._string=this._toString(this._value))}setValue(t){if(R.str(t)){if(t==this._string)return!1;this._string=t,this._value=1}else if(super.setValue(t))this._string=null;else return!1;return!0}reset(t){t&&(this._toString=Yt({output:[this.getValue(),t]})),this._value=0,super.reset()}}const Tn={dependencies:null};class Ei extends Gr{constructor(t){super(),this.source=t,this.setValue(t)}getValue(t){const n={};return tt(this.source,(i,s)=>{so(i)?n[s]=i.getValue(t):We(i)?n[s]=De(i):t||(n[s]=i)}),n}setValue(t){this.source=t,this.payload=this._makePayload(t)}reset(){this.payload&&ee(this.payload,t=>t.reset())}_makePayload(t){if(t){const n=new Set;return tt(t,this._addToPayload,n),Array.from(n)}}_addToPayload(t){Tn.dependencies&&We(t)&&Tn.dependencies.add(t);const n=Dn(t);n&&ee(n,i=>this.add(i))}}class wi extends Ei{constructor(t){super(t)}static create(t){return new wi(t)}getValue(){return this.source.map(t=>t.getValue())}setValue(t){const n=this.getPayload();return t.length==n.length?n.map((i,s)=>i.setValue(t[s])).some(Boolean):(super.setValue(t.map(ao)),!0)}}function ao(e){return(Pn(e)?Ct:Dt).create(e)}function ei(e){const t=Ze(e);return t?t.constructor:R.arr(e)?wi:Pn(e)?Ct:Dt}function Mn(){return Mn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Mn.apply(this,arguments)}const Qi=(e,t)=>{const n=!R.fun(e)||e.prototype&&e.prototype.isReactComponent;return D.forwardRef((i,s)=>{const o=D.useRef(null),l=n&&D.useCallback(C=>{o.current=uo(s,C)},[s]),[f,c]=lo(i,t),h=kr(),m=()=>{const C=o.current;if(n&&!C)return;(C?t.applyAnimatedValues(C,f.getValue(!0)):!1)===!1&&h()},S=new oo(m,c),w=D.useRef();xi(()=>(w.current=S,ee(c,C=>on(C,S)),()=>{w.current&&(ee(w.current.deps,C=>bn(C,w.current)),$.cancel(w.current.update))})),D.useEffect(m,[]),Hr(()=>()=>{const C=w.current;ee(C.deps,B=>bn(B,C))});const U=t.getComponentProps(f.getValue());return D.createElement(e,Mn({},U,{ref:l}))})};class oo{constructor(t,n){this.update=t,this.deps=n}eventObserved(t){t.type=="change"&&$.write(this.update)}}function lo(e,t){const n=new Set;return Tn.dependencies=n,e.style&&(e=Mn({},e,{style:t.createAnimatedStyle(e.style)})),e=new Ei(e),Tn.dependencies=null,[e,n]}function uo(e,t){return e&&(R.fun(e)?e(t):e.current=t),t}const Ki=Symbol.for("AnimatedComponent"),co=(e,{applyAnimatedValues:t=()=>!1,createAnimatedStyle:n=s=>new Ei(s),getComponentProps:i=s=>s}={})=>{const s={applyAnimatedValues:t,createAnimatedStyle:n,getComponentProps:i},o=l=>{const f=Yi(l)||"Anonymous";return R.str(l)?l=o[l]||(o[l]=Qi(l,s)):l=l[Ki]||(l[Ki]=Qi(l,s)),l.displayName=`Animated(${f})`,l};return tt(e,(l,f)=>{R.arr(e)&&(f=Yi(l)),o[f]=o(l)}),{animated:o}},Yi=e=>R.str(e)?e:e&&R.str(e.displayName)?e.displayName:R.fun(e)&&e.name||null;function ge(){return ge=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},ge.apply(this,arguments)}function St(e,...t){return R.fun(e)?e(...t):e}const Qt=(e,t)=>e===!0||!!(t&&e&&(R.fun(e)?e(t):ze(e).includes(t))),Vr=(e,t)=>R.obj(e)?t&&e[t]:e,Zr=(e,t)=>e.default===!0?e[t]:e.default?e.default[t]:void 0,fo=e=>e,bi=(e,t=fo)=>{let n=ho;e.default&&e.default!==!0&&(e=e.default,n=Object.keys(e));const i={};for(const s of n){const o=t(e[s],s);R.und(o)||(i[s]=o)}return i},ho=["config","onProps","onStart","onChange","onPause","onResume","onRest"],vo={config:1,from:1,to:1,ref:1,loop:1,reset:1,pause:1,cancel:1,reverse:1,immediate:1,default:1,delay:1,onProps:1,onStart:1,onChange:1,onPause:1,onResume:1,onRest:1,onResolve:1,items:1,trail:1,sort:1,expires:1,initial:1,enter:1,update:1,leave:1,children:1,onDestroyed:1,keys:1,callId:1,parentId:1};function po(e){const t={};let n=0;if(tt(e,(i,s)=>{vo[s]||(t[s]=i,n++)}),n)return t}function Wr(e){const t=po(e);if(t){const n={to:t};return tt(e,(i,s)=>s in t||(n[s]=i)),n}return ge({},e)}function en(e){return e=De(e),R.arr(e)?e.map(en):Pn(e)?je.createStringInterpolator({range:[0,1],output:[e,e]})(1):e}function mo(e){for(const t in e)return!0;return!1}function ti(e){return R.fun(e)||R.arr(e)&&R.obj(e[0])}function go(e,t){var n;(n=e.ref)==null||n.delete(e),t?.delete(e)}function So(e,t){if(t&&e.ref!==t){var n;(n=e.ref)==null||n.delete(e),t.add(e),e.ref=t}}const _o={default:{tension:170,friction:26},gentle:{tension:120,friction:14},wobbly:{tension:180,friction:12},stiff:{tension:210,friction:20},slow:{tension:280,friction:60},molasses:{tension:280,friction:120}},ni=ge({},_o.default,{mass:1,damping:1,easing:Va.linear,clamp:!1});class xo{constructor(){this.tension=void 0,this.friction=void 0,this.frequency=void 0,this.damping=void 0,this.mass=void 0,this.velocity=0,this.restVelocity=void 0,this.precision=void 0,this.progress=void 0,this.duration=void 0,this.easing=void 0,this.clamp=void 0,this.bounce=void 0,this.decay=void 0,this.round=void 0,Object.assign(this,ni)}}function yo(e,t,n){n&&(n=ge({},n),Ji(n,t),t=ge({},n,t)),Ji(e,t),Object.assign(e,t);for(const l in ni)e[l]==null&&(e[l]=ni[l]);let{mass:i,frequency:s,damping:o}=e;return R.und(s)||(s<.01&&(s=.01),o<0&&(o=0),e.tension=Math.pow(2*Math.PI/s,2)*i,e.friction=4*Math.PI*o*i/s),e}function Ji(e,t){if(!R.und(t.decay))e.duration=void 0;else{const n=!R.und(t.tension)||!R.und(t.friction);(n||!R.und(t.frequency)||!R.und(t.damping)||!R.und(t.mass))&&(e.duration=void 0,e.decay=void 0),n&&(e.frequency=void 0)}}const er=[];class Eo{constructor(){this.changed=!1,this.values=er,this.toValues=null,this.fromValues=er,this.to=void 0,this.from=void 0,this.config=new xo,this.immediate=!1}}function $r(e,{key:t,props:n,defaultProps:i,state:s,actions:o}){return new Promise((l,f)=>{var c;let h,m,S=Qt((c=n.cancel)!=null?c:i?.cancel,t);if(S)C();else{R.und(n.pause)||(s.paused=Qt(n.pause,t));let B=i?.pause;B!==!0&&(B=s.paused||Qt(B,t)),h=St(n.delay||0,t),B?(s.resumeQueue.add(U),o.pause()):(o.resume(),U())}function w(){s.resumeQueue.add(U),s.timeouts.delete(m),m.cancel(),h=m.time-$.now()}function U(){h>0&&!je.skipAnimation?(s.delayed=!0,m=$.setTimeout(C,h),s.pauseQueue.add(w),s.timeouts.add(m)):C()}function C(){s.delayed&&(s.delayed=!1),s.pauseQueue.delete(w),s.timeouts.delete(m),e<=(s.cancelId||0)&&(S=!0);try{o.start(ge({},n,{callId:e,cancel:S}),l)}catch(B){f(B)}}})}const Ti=(e,t)=>t.length==1?t[0]:t.some(n=>n.cancelled)?At(e.get()):t.every(n=>n.noop)?jr(e.get()):ke(e.get(),t.every(n=>n.finished)),jr=e=>({value:e,noop:!0,finished:!0,cancelled:!1}),ke=(e,t,n=!1)=>({value:e,finished:t,cancelled:n}),At=e=>({value:e,cancelled:!0,finished:!1});function qr(e,t,n,i){const{callId:s,parentId:o,onRest:l}=t,{asyncTo:f,promise:c}=n;return!o&&e===f&&!t.reset?c:n.promise=(async()=>{n.asyncId=s,n.asyncTo=e;const h=bi(t,(A,P)=>P==="onRest"?void 0:A);let m,S;const w=new Promise((A,P)=>(m=A,S=P)),U=A=>{const P=s<=(n.cancelId||0)&&At(i)||s!==n.asyncId&&ke(i,!1);if(P)throw A.result=P,S(A),A},C=(A,P)=>{const E=new tr,g=new nr;return(async()=>{if(je.skipAnimation)throw tn(n),g.result=ke(i,!1),S(g),g;U(E);const y=R.obj(A)?ge({},A):ge({},P,{to:A});y.parentId=s,tt(h,(z,Z)=>{R.und(y[Z])&&(y[Z]=z)});const k=await i.start(y);return U(E),n.paused&&await new Promise(z=>{n.resumeQueue.add(z)}),k})()};let B;if(je.skipAnimation)return tn(n),ke(i,!1);try{let A;R.arr(e)?A=(async P=>{for(const E of P)await C(E)})(e):A=Promise.resolve(e(C,i.stop.bind(i))),await Promise.all([A.then(m),w]),B=ke(i.get(),!0,!1)}catch(A){if(A instanceof tr)B=A.result;else if(A instanceof nr)B=A.result;else throw A}finally{s==n.asyncId&&(n.asyncId=o,n.asyncTo=o?f:void 0,n.promise=o?c:void 0)}return R.fun(l)&&$.batchedUpdates(()=>{l(B,i,i.item)}),B})()}function tn(e,t){qt(e.timeouts,n=>n.cancel()),e.pauseQueue.clear(),e.resumeQueue.clear(),e.asyncId=e.asyncTo=e.promise=void 0,t&&(e.cancelId=t)}class tr extends Error{constructor(){super("An async animation has been interrupted. You see this error because you forgot to use `await` or `.catch(...)` on its returned promise."),this.result=void 0}}class nr extends Error{constructor(){super("SkipAnimationSignal"),this.result=void 0}}const ii=e=>e instanceof Mi;let wo=1;class Mi extends Wa{constructor(...t){super(...t),this.id=wo++,this.key=void 0,this._priority=0}get priority(){return this._priority}set priority(t){this._priority!=t&&(this._priority=t,this._onPriorityChange(t))}get(){const t=Ze(this);return t&&t.getValue()}to(...t){return je.to(this,t)}interpolate(...t){return Ya(),je.to(this,t)}toJSON(){return this.get()}observerAdded(t){t==1&&this._attach()}observerRemoved(t){t==0&&this._detach()}_attach(){}_detach(){}_onChange(t,n=!1){wn(this,{type:"change",parent:this,value:t,idle:n})}_onPriorityChange(t){this.idle||Un.sort(this),wn(this,{type:"priority",parent:this,priority:t})}}const Et=Symbol.for("SpringPhase"),Xr=1,ri=2,si=4,Hn=e=>(e[Et]&Xr)>0,rt=e=>(e[Et]&ri)>0,Ht=e=>(e[Et]&si)>0,ir=(e,t)=>t?e[Et]|=ri|Xr:e[Et]&=~ri,rr=(e,t)=>t?e[Et]|=si:e[Et]&=~si;class bo extends Mi{constructor(t,n){if(super(),this.key=void 0,this.animation=new Eo,this.queue=void 0,this.defaultProps={},this._state={paused:!1,delayed:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._pendingCalls=new Set,this._lastCallId=0,this._lastToId=0,this._memoizedDuration=0,!R.und(t)||!R.und(n)){const i=R.obj(t)?ge({},t):ge({},n,{from:t});R.und(i.default)&&(i.default=!0),this.start(i)}}get idle(){return!(rt(this)||this._state.asyncTo)||Ht(this)}get goal(){return De(this.animation.to)}get velocity(){const t=Ze(this);return t instanceof Dt?t.lastVelocity||0:t.getPayload().map(n=>n.lastVelocity||0)}get hasAnimated(){return Hn(this)}get isAnimating(){return rt(this)}get isPaused(){return Ht(this)}get isDelayed(){return this._state.delayed}advance(t){let n=!0,i=!1;const s=this.animation;let{config:o,toValues:l}=s;const f=Dn(s.to);!f&&We(s.to)&&(l=ze(De(s.to))),s.values.forEach((m,S)=>{if(m.done)return;const w=m.constructor==Ct?1:f?f[S].lastPosition:l[S];let U=s.immediate,C=w;if(!U){if(C=m.lastPosition,o.tension<=0){m.done=!0;return}let B=m.elapsedTime+=t;const A=s.fromValues[S],P=m.v0!=null?m.v0:m.v0=R.arr(o.velocity)?o.velocity[S]:o.velocity;let E;const g=o.precision||(A==w?.005:Math.min(1,Math.abs(w-A)*.001));if(R.und(o.duration))if(o.decay){const y=o.decay===!0?.998:o.decay,k=Math.exp(-(1-y)*B);C=A+P/(1-y)*(1-k),U=Math.abs(m.lastPosition-C)<=g,E=P*k}else{E=m.lastVelocity==null?P:m.lastVelocity;const y=o.restVelocity||g/10,k=o.clamp?0:o.bounce,z=!R.und(k),Z=A==w?m.v0>0:A<w;let L,F=!1;const G=1,N=Math.ceil(t/G);for(let W=0;W<N&&(L=Math.abs(E)>y,!(!L&&(U=Math.abs(w-C)<=g,U)));++W){z&&(F=C==w||C>w==Z,F&&(E=-E*k,C=w));const fe=-o.tension*1e-6*(C-w),he=-o.friction*.001*E,de=(fe+he)/o.mass;E=E+de*G,C=C+E*G}}else{let y=1;o.duration>0&&(this._memoizedDuration!==o.duration&&(this._memoizedDuration=o.duration,m.durationProgress>0&&(m.elapsedTime=o.duration*m.durationProgress,B=m.elapsedTime+=t)),y=(o.progress||0)+B/this._memoizedDuration,y=y>1?1:y<0?0:y,m.durationProgress=y),C=A+o.easing(y)*(w-A),E=(C-m.lastPosition)/t,U=y==1}m.lastVelocity=E,Number.isNaN(C)&&(console.warn("Got NaN while animating:",this),U=!0)}f&&!f[S].done&&(U=!1),U?m.done=!0:n=!1,m.setValue(C,o.round)&&(i=!0)});const c=Ze(this),h=c.getValue();if(n){const m=De(s.to);(h!==m||i)&&!o.decay?(c.setValue(m),this._onChange(m)):i&&o.decay&&this._onChange(h),this._stop()}else i&&this._onChange(h)}set(t){return $.batchedUpdates(()=>{this._stop(),this._focus(t),this._set(t)}),this}pause(){this._update({pause:!0})}resume(){this._update({pause:!1})}finish(){if(rt(this)){const{to:t,config:n}=this.animation;$.batchedUpdates(()=>{this._onStart(),n.decay||this._set(t,!1),this._stop()})}return this}update(t){return(this.queue||(this.queue=[])).push(t),this}start(t,n){let i;return R.und(t)?(i=this.queue||[],this.queue=[]):i=[R.obj(t)?t:ge({},n,{to:t})],Promise.all(i.map(s=>this._update(s))).then(s=>Ti(this,s))}stop(t){const{to:n}=this.animation;return this._focus(this.get()),tn(this._state,t&&this._lastCallId),$.batchedUpdates(()=>this._stop(n,t)),this}reset(){this._update({reset:!0})}eventObserved(t){t.type=="change"?this._start():t.type=="priority"&&(this.priority=t.priority+1)}_prepareNode(t){const n=this.key||"";let{to:i,from:s}=t;i=R.obj(i)?i[n]:i,(i==null||ti(i))&&(i=void 0),s=R.obj(s)?s[n]:s,s==null&&(s=void 0);const o={to:i,from:s};return Hn(this)||(t.reverse&&([i,s]=[s,i]),s=De(s),R.und(s)?Ze(this)||this._set(i):this._set(s)),o}_update(t,n){let i=ge({},t);const{key:s,defaultProps:o}=this;i.default&&Object.assign(o,bi(i,(c,h)=>/^on/.test(h)?Vr(c,s):c)),ar(this,i,"onProps"),Vt(this,"onProps",i,this);const l=this._prepareNode(i);if(Object.isFrozen(this))throw Error("Cannot animate a `SpringValue` object that is frozen. Did you forget to pass your component to `animated(...)` before animating its props?");const f=this._state;return $r(++this._lastCallId,{key:s,props:i,defaultProps:o,state:f,actions:{pause:()=>{Ht(this)||(rr(this,!0),jt(f.pauseQueue),Vt(this,"onPause",ke(this,Gt(this,this.animation.to)),this))},resume:()=>{Ht(this)&&(rr(this,!1),rt(this)&&this._resume(),jt(f.resumeQueue),Vt(this,"onResume",ke(this,Gt(this,this.animation.to)),this))},start:this._merge.bind(this,l)}}).then(c=>{if(i.loop&&c.finished&&!(n&&c.noop)){const h=Qr(i);if(h)return this._update(h,!0)}return c})}_merge(t,n,i){if(n.cancel)return this.stop(!0),i(At(this));const s=!R.und(t.to),o=!R.und(t.from);if(s||o)if(n.callId>this._lastToId)this._lastToId=n.callId;else return i(At(this));const{key:l,defaultProps:f,animation:c}=this,{to:h,from:m}=c;let{to:S=h,from:w=m}=t;o&&!s&&(!n.default||R.und(S))&&(S=w),n.reverse&&([S,w]=[w,S]);const U=!Je(w,m);U&&(c.from=w),w=De(w);const C=!Je(S,h);C&&this._focus(S);const B=ti(n.to),{config:A}=c,{decay:P,velocity:E}=A;(s||o)&&(A.velocity=0),n.config&&!B&&yo(A,St(n.config,l),n.config!==f.config?St(f.config,l):void 0);let g=Ze(this);if(!g||R.und(S))return i(ke(this,!0));const y=R.und(n.reset)?o&&!n.default:!R.und(w)&&Qt(n.reset,l),k=y?w:this.get(),z=en(S),Z=R.num(z)||R.arr(z)||Pn(z),L=!B&&(!Z||Qt(f.immediate||n.immediate,l));if(C){const W=ei(S);if(W!==g.constructor)if(L)g=this._set(z);else throw Error(`Cannot animate between ${g.constructor.name} and ${W.name}, as the "to" prop suggests`)}const F=g.constructor;let G=We(S),N=!1;if(!G){const W=y||!Hn(this)&&U;(C||W)&&(N=Je(en(k),z),G=!N),(!Je(c.immediate,L)&&!L||!Je(A.decay,P)||!Je(A.velocity,E))&&(G=!0)}if(N&&rt(this)&&(c.changed&&!y?G=!0:G||this._stop(h)),!B&&((G||We(h))&&(c.values=g.getPayload(),c.toValues=We(S)?null:F==Ct?[1]:ze(z)),c.immediate!=L&&(c.immediate=L,!L&&!y&&this._set(h)),G)){const{onRest:W}=c;ee(Mo,he=>ar(this,n,he));const fe=ke(this,Gt(this,h));jt(this._pendingCalls,fe),this._pendingCalls.add(i),c.changed&&$.batchedUpdates(()=>{c.changed=!y,W?.(fe,this),y?St(f.onRest,fe):c.onStart==null||c.onStart(fe,this)})}y&&this._set(k),B?i(qr(n.to,n,this._state,this)):G?this._start():rt(this)&&!C?this._pendingCalls.add(i):i(jr(k))}_focus(t){const n=this.animation;t!==n.to&&(ji(this)&&this._detach(),n.to=t,ji(this)&&this._attach())}_attach(){let t=0;const{to:n}=this.animation;We(n)&&(on(n,this),ii(n)&&(t=n.priority+1)),this.priority=t}_detach(){const{to:t}=this.animation;We(t)&&bn(t,this)}_set(t,n=!0){const i=De(t);if(!R.und(i)){const s=Ze(this);if(!s||!Je(i,s.getValue())){const o=ei(i);!s||s.constructor!=o?yi(this,o.create(i)):s.setValue(i),s&&$.batchedUpdates(()=>{this._onChange(i,n)})}}return Ze(this)}_onStart(){const t=this.animation;t.changed||(t.changed=!0,Vt(this,"onStart",ke(this,Gt(this,t.to)),this))}_onChange(t,n){n||(this._onStart(),St(this.animation.onChange,t,this)),St(this.defaultProps.onChange,t,this),super._onChange(t,n)}_start(){const t=this.animation;Ze(this).reset(De(t.to)),t.immediate||(t.fromValues=t.values.map(n=>n.lastPosition)),rt(this)||(ir(this,!0),Ht(this)||this._resume())}_resume(){je.skipAnimation?this.finish():Un.start(this)}_stop(t,n){if(rt(this)){ir(this,!1);const i=this.animation;ee(i.values,o=>{o.done=!0}),i.toValues&&(i.onChange=i.onPause=i.onResume=void 0),wn(this,{type:"idle",parent:this});const s=n?At(this.get()):ke(this.get(),Gt(this,t??i.to));jt(this._pendingCalls,s),i.changed&&(i.changed=!1,Vt(this,"onRest",s,this))}}}function Gt(e,t){const n=en(t),i=en(e.get());return Je(i,n)}function Qr(e,t=e.loop,n=e.to){let i=St(t);if(i){const s=i!==!0&&Wr(i),o=(s||e).reverse,l=!s||s.reset;return nn(ge({},e,{loop:t,default:!1,pause:void 0,to:!o||ti(n)?n:void 0,from:l?e.from:void 0,reset:l},s))}}function nn(e){const{to:t,from:n}=e=Wr(e),i=new Set;return R.obj(t)&&sr(t,i),R.obj(n)&&sr(n,i),e.keys=i.size?Array.from(i):null,e}function To(e){const t=nn(e);return R.und(t.default)&&(t.default=bi(t)),t}function sr(e,t){tt(e,(n,i)=>n!=null&&t.add(i))}const Mo=["onStart","onRest","onChange","onPause","onResume"];function ar(e,t,n){e.animation[n]=t[n]!==Zr(t,n)?Vr(t[n],e.key):void 0}function Vt(e,t,...n){var i,s,o,l;(i=(s=e.animation)[t])==null||i.call(s,...n),(o=(l=e.defaultProps)[t])==null||o.call(l,...n)}const Ro=["onStart","onChange","onRest"];let Ao=1;class Io{constructor(t,n){this.id=Ao++,this.springs={},this.queue=[],this.ref=void 0,this._flush=void 0,this._initialProps=void 0,this._lastAsyncId=0,this._active=new Set,this._changed=new Set,this._started=!1,this._item=void 0,this._state={paused:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._events={onStart:new Map,onChange:new Map,onRest:new Map},this._onFrame=this._onFrame.bind(this),n&&(this._flush=n),t&&this.start(ge({default:!0},t))}get idle(){return!this._state.asyncTo&&Object.values(this.springs).every(t=>t.idle&&!t.isDelayed&&!t.isPaused)}get item(){return this._item}set item(t){this._item=t}get(){const t={};return this.each((n,i)=>t[i]=n.get()),t}set(t){for(const n in t){const i=t[n];R.und(i)||this.springs[n].set(i)}}update(t){return t&&this.queue.push(nn(t)),this}start(t){let{queue:n}=this;return t?n=ze(t).map(nn):this.queue=[],this._flush?this._flush(this,n):(ts(this,n),ai(this,n))}stop(t,n){if(t!==!!t&&(n=t),n){const i=this.springs;ee(ze(n),s=>i[s].stop(!!t))}else tn(this._state,this._lastAsyncId),this.each(i=>i.stop(!!t));return this}pause(t){if(R.und(t))this.start({pause:!0});else{const n=this.springs;ee(ze(t),i=>n[i].pause())}return this}resume(t){if(R.und(t))this.start({pause:!1});else{const n=this.springs;ee(ze(t),i=>n[i].resume())}return this}each(t){tt(this.springs,t)}_onFrame(){const{onStart:t,onChange:n,onRest:i}=this._events,s=this._active.size>0,o=this._changed.size>0;(s&&!this._started||o&&!this._started)&&(this._started=!0,qt(t,([c,h])=>{h.value=this.get(),c(h,this,this._item)}));const l=!s&&this._started,f=o||l&&i.size?this.get():null;o&&n.size&&qt(n,([c,h])=>{h.value=f,c(h,this,this._item)}),l&&(this._started=!1,qt(i,([c,h])=>{h.value=f,c(h,this,this._item)}))}eventObserved(t){if(t.type=="change")this._changed.add(t.parent),t.idle||this._active.add(t.parent);else if(t.type=="idle")this._active.delete(t.parent);else return;$.onFrame(this._onFrame)}}function ai(e,t){return Promise.all(t.map(n=>Kr(e,n))).then(n=>Ti(e,n))}async function Kr(e,t,n){const{keys:i,to:s,from:o,loop:l,onRest:f,onResolve:c}=t,h=R.obj(t.default)&&t.default;l&&(t.loop=!1),s===!1&&(t.to=null),o===!1&&(t.from=null);const m=R.arr(s)||R.fun(s)?s:void 0;m?(t.to=void 0,t.onRest=void 0,h&&(h.onRest=void 0)):ee(Ro,B=>{const A=t[B];if(R.fun(A)){const P=e._events[B];t[B]=({finished:E,cancelled:g})=>{const y=P.get(A);y?(E||(y.finished=!1),g&&(y.cancelled=!0)):P.set(A,{value:null,finished:E||!1,cancelled:g||!1})},h&&(h[B]=t[B])}});const S=e._state;t.pause===!S.paused?(S.paused=t.pause,jt(t.pause?S.pauseQueue:S.resumeQueue)):S.paused&&(t.pause=!0);const w=(i||Object.keys(e.springs)).map(B=>e.springs[B].start(t)),U=t.cancel===!0||Zr(t,"cancel")===!0;(m||U&&S.asyncId)&&w.push($r(++e._lastAsyncId,{props:t,state:S,actions:{pause:Kn,resume:Kn,start(B,A){U?(tn(S,e._lastAsyncId),A(At(e))):(B.onRest=f,A(qr(m,B,S,e)))}}})),S.paused&&await new Promise(B=>{S.resumeQueue.add(B)});const C=Ti(e,await Promise.all(w));if(l&&C.finished&&!(n&&C.noop)){const B=Qr(t,l,s);if(B)return ts(e,[B]),Kr(e,B,!0)}return c&&$.batchedUpdates(()=>c(C,e,e.item)),C}function or(e,t){const n=ge({},e.springs);return t&&ee(ze(t),i=>{R.und(i.keys)&&(i=nn(i)),R.obj(i.to)||(i=ge({},i,{to:void 0})),es(n,i,s=>Jr(s))}),Yr(e,n),n}function Yr(e,t){tt(t,(n,i)=>{e.springs[i]||(e.springs[i]=n,on(n,e))})}function Jr(e,t){const n=new bo;return n.key=e,t&&on(n,t),n}function es(e,t,n){t.keys&&ee(t.keys,i=>{(e[i]||(e[i]=n(i)))._prepareNode(t)})}function ts(e,t){ee(t,n=>{es(e.springs,n,i=>Jr(i,e))})}function Uo(e,t){if(e==null)return{};var n={},i=Object.keys(e),s,o;for(o=0;o<i.length;o++)s=i[o],!(t.indexOf(s)>=0)&&(n[s]=e[s]);return n}const Co=["children"],On=e=>{let{children:t}=e,n=Uo(e,Co);const i=D.useContext(Rn),s=n.pause||!!i.pause,o=n.immediate||!!i.immediate;n=no(()=>({pause:s,immediate:o}),[s,o]);const{Provider:l}=Rn;return D.createElement(l,{value:n},t)},Rn=Bo(On,{});On.Provider=Rn.Provider;On.Consumer=Rn.Consumer;function Bo(e,t){return Object.assign(e,D.createContext(t)),e.Provider._context=e,e.Consumer._context=e,e}const Po=()=>{const e=[],t=function(s){eo();const o=[];return ee(e,(l,f)=>{if(R.und(s))o.push(l.start());else{const c=n(s,l,f);c&&o.push(l.start(c))}}),o};t.current=e,t.add=function(i){e.includes(i)||e.push(i)},t.delete=function(i){const s=e.indexOf(i);~s&&e.splice(s,1)},t.pause=function(){return ee(e,i=>i.pause(...arguments)),this},t.resume=function(){return ee(e,i=>i.resume(...arguments)),this},t.set=function(i){ee(e,s=>s.set(i))},t.start=function(i){const s=[];return ee(e,(o,l)=>{if(R.und(i))s.push(o.start());else{const f=this._getProps(i,o,l);f&&s.push(o.start(f))}}),s},t.stop=function(){return ee(e,i=>i.stop(...arguments)),this},t.update=function(i){return ee(e,(s,o)=>s.update(this._getProps(i,s,o))),this};const n=function(s,o,l){return R.fun(s)?s(l,o):s};return t._getProps=n,t};function Do(e,t,n){const i=R.fun(t)&&t;i&&!n&&(n=[]);const s=D.useMemo(()=>i||arguments.length==3?Po():void 0,[]),o=D.useRef(0),l=kr(),f=D.useMemo(()=>({ctrls:[],queue:[],flush(P,E){const g=or(P,E);return o.current>0&&!f.queue.length&&!Object.keys(g).some(k=>!P.springs[k])?ai(P,E):new Promise(k=>{Yr(P,g),f.queue.push(()=>{k(ai(P,E))}),l()})}}),[]),c=D.useRef([...f.ctrls]),h=[],m=Xi(e)||0;D.useMemo(()=>{ee(c.current.slice(e,m),P=>{go(P,s),P.stop(!0)}),c.current.length=e,S(m,e)},[e]),D.useMemo(()=>{S(0,Math.min(m,e))},n);function S(P,E){for(let g=P;g<E;g++){const y=c.current[g]||(c.current[g]=new Io(null,f.flush)),k=i?i(g,y):t[g];k&&(h[g]=To(k))}}const w=c.current.map((P,E)=>or(P,h[E])),U=D.useContext(On),C=Xi(U),B=U!==C&&mo(U);xi(()=>{o.current++,f.ctrls=c.current;const{queue:P}=f;P.length&&(f.queue=[],ee(P,E=>E())),ee(c.current,(E,g)=>{s?.add(E),B&&E.start({default:U});const y=h[g];y&&(So(E,y.ref),E.ref?E.queue.push(y):E.start(y))})}),Hr(()=>()=>{ee(f.ctrls,P=>P.stop(!0))});const A=w.map(P=>ge({},P));return s?[A,s]:A}function Oo(e,t){const n=R.fun(e),[[i],s]=Do(1,n?e:[e],n?t||[]:t);return n||arguments.length==2?[i,s]:i}let lr;(function(e){e.MOUNT="mount",e.ENTER="enter",e.UPDATE="update",e.LEAVE="leave"})(lr||(lr={}));class No extends Mi{constructor(t,n){super(),this.key=void 0,this.idle=!0,this.calc=void 0,this._active=new Set,this.source=t,this.calc=Yt(...n);const i=this._get(),s=ei(i);yi(this,s.create(i))}advance(t){const n=this._get(),i=this.get();Je(n,i)||(Ze(this).setValue(n),this._onChange(n,this.idle)),!this.idle&&ur(this._active)&&Gn(this)}_get(){const t=R.arr(this.source)?this.source.map(De):ze(De(this.source));return this.calc(...t)}_start(){this.idle&&!ur(this._active)&&(this.idle=!1,ee(Dn(this),t=>{t.done=!1}),je.skipAnimation?($.batchedUpdates(()=>this.advance()),Gn(this)):Un.start(this))}_attach(){let t=1;ee(ze(this.source),n=>{We(n)&&on(n,this),ii(n)&&(n.idle||this._active.add(n),t=Math.max(t,n.priority+1))}),this.priority=t,this._start()}_detach(){ee(ze(this.source),t=>{We(t)&&bn(t,this)}),this._active.clear(),Gn(this)}eventObserved(t){t.type=="change"?t.idle?this.advance():(this._active.add(t.parent),this._start()):t.type=="idle"?this._active.delete(t.parent):t.type=="priority"&&(this.priority=ze(this.source).reduce((n,i)=>Math.max(n,(ii(i)?i.priority:0)+1),0))}}function zo(e){return e.idle!==!1}function ur(e){return!e.size||Array.from(e).every(zo)}function Gn(e){e.idle||(e.idle=!0,ee(Dn(e),t=>{t.done=!0}),wn(e,{type:"idle",parent:e}))}je.assign({createStringInterpolator:Lr,to:(e,t)=>new No(e,t)});const Lo=["primitive"].concat(Object.keys(Qs).filter(e=>/^[A-Z]/.test(e)).map(e=>e[0].toLowerCase()+e.slice(1)));je.assign({createStringInterpolator:Lr,colors:Ua,frameLoop:"demand"});Ks(()=>{$.advance()});const Fo=co(Lo,{applyAnimatedValues:Ys}),ko=Fo.animated;function Ho({enabled:e=!0,snap:t,global:n,domElement:i,cursor:s=!0,children:o,speed:l=1,rotation:f=[0,0,0],zoom:c=1,polar:h=[0,Math.PI/2],azimuth:m=[-1/0,1/0],config:S={mass:1,tension:170,friction:26}}){const w=et(z=>z.events),U=et(z=>z.gl),C=i||w.connected||U.domElement,{size:B}=et(),A=D.useMemo(()=>[f[0]+h[0],f[0]+h[1]],[f[0],h[0],h[1]]),P=D.useMemo(()=>[f[1]+m[0],f[1]+m[1]],[f[1],m[0],m[1]]),E=D.useMemo(()=>[hn.clamp(f[0],...A),hn.clamp(f[1],...P),f[2]],[f[0],f[1],f[2],A,P]),[g,y]=Oo(()=>({scale:1,rotation:E,config:S}));D.useEffect(()=>void y.start({scale:1,rotation:E,config:S}),[E]),D.useEffect(()=>{if(n&&s&&e)return C.style.cursor="grab",U.domElement.style.cursor="",()=>{C.style.cursor="default",U.domElement.style.cursor="default"}},[n,s,C,e]);const k=Js({onHover:({last:z})=>{s&&!n&&e&&(C.style.cursor=z?"auto":"grab")},onDrag:({down:z,delta:[Z,L],memo:[F,G]=g.rotation.animation.to||E})=>{if(!e)return[L,Z];s&&(C.style.cursor=z?"grabbing":"grab"),Z=hn.clamp(G+Z/B.width*Math.PI*l,...P),L=hn.clamp(F+L/B.height*Math.PI*l,...A);const N=t&&!z&&typeof t!="boolean"?t:S;return y.start({scale:z&&L>A[1]/2?c:1,rotation:t&&!z?E:[L,Z,0],config:W=>W==="scale"?{...N,friction:N.friction*3}:N}),[L,Z]}},{target:n?C:void 0});return D.createElement(ko.group,mr({},k?.(),g),o)}let Zt;function Go(){var e;if(Zt!==void 0)return Zt;try{let t;const n=document.createElement("canvas");return Zt=!!(window.WebGL2RenderingContext&&(t=n.getContext("webgl2"))),t&&((e=t.getExtension("WEBGL_lose_context"))==null||e.loseContext()),Zt}catch{return Zt=!1}}var Ne=Uint8Array,ct=Uint16Array,oi=Uint32Array,ns=new Ne([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),is=new Ne([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Vo=new Ne([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),rs=function(e,t){for(var n=new ct(31),i=0;i<31;++i)n[i]=t+=1<<e[i-1];for(var s=new oi(n[30]),i=1;i<30;++i)for(var o=n[i];o<n[i+1];++o)s[o]=o-n[i]<<5|i;return[n,s]},ss=rs(ns,2),as=ss[0],Zo=ss[1];as[28]=258,Zo[258]=28;var Wo=rs(is,0),$o=Wo[0],li=new ct(32768);for(var le=0;le<32768;++le){var st=(le&43690)>>>1|(le&21845)<<1;st=(st&52428)>>>2|(st&13107)<<2,st=(st&61680)>>>4|(st&3855)<<4,li[le]=((st&65280)>>>8|(st&255)<<8)>>>1}var Kt=function(e,t,n){for(var i=e.length,s=0,o=new ct(t);s<i;++s)++o[e[s]-1];var l=new ct(t);for(s=0;s<t;++s)l[s]=l[s-1]+o[s-1]<<1;var f;if(n){f=new ct(1<<t);var c=15-t;for(s=0;s<i;++s)if(e[s])for(var h=s<<4|e[s],m=t-e[s],S=l[e[s]-1]++<<m,w=S|(1<<m)-1;S<=w;++S)f[li[S]>>>c]=h}else for(f=new ct(i),s=0;s<i;++s)e[s]&&(f[s]=li[l[e[s]-1]++]>>>15-e[s]);return f},ln=new Ne(288);for(var le=0;le<144;++le)ln[le]=8;for(var le=144;le<256;++le)ln[le]=9;for(var le=256;le<280;++le)ln[le]=7;for(var le=280;le<288;++le)ln[le]=8;var os=new Ne(32);for(var le=0;le<32;++le)os[le]=5;var jo=Kt(ln,9,1),qo=Kt(os,5,1),Vn=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},Fe=function(e,t,n){var i=t/8|0;return(e[i]|e[i+1]<<8)>>(t&7)&n},Zn=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(t&7)},Xo=function(e){return(e/8|0)+(e&7&&1)},Qo=function(e,t,n){(t==null||t<0)&&(t=0),(n==null||n>e.length)&&(n=e.length);var i=new(e instanceof ct?ct:e instanceof oi?oi:Ne)(n-t);return i.set(e.subarray(t,n)),i},Ko=function(e,t,n){var i=e.length;if(!i||n&&!n.l&&i<5)return t||new Ne(0);var s=!t||n,o=!n||n.i;n||(n={}),t||(t=new Ne(i*3));var l=function(ne){var Xe=t.length;if(ne>Xe){var Qe=new Ne(Math.max(Xe*2,ne));Qe.set(t),t=Qe}},f=n.f||0,c=n.p||0,h=n.b||0,m=n.l,S=n.d,w=n.m,U=n.n,C=i*8;do{if(!m){n.f=f=Fe(e,c,1);var B=Fe(e,c+1,3);if(c+=3,B)if(B==1)m=jo,S=qo,w=9,U=5;else if(B==2){var g=Fe(e,c,31)+257,y=Fe(e,c+10,15)+4,k=g+Fe(e,c+5,31)+1;c+=14;for(var z=new Ne(k),Z=new Ne(19),L=0;L<y;++L)Z[Vo[L]]=Fe(e,c+L*3,7);c+=y*3;for(var F=Vn(Z),G=(1<<F)-1,N=Kt(Z,F,1),L=0;L<k;){var W=N[Fe(e,c,G)];c+=W&15;var A=W>>>4;if(A<16)z[L++]=A;else{var fe=0,he=0;for(A==16?(he=3+Fe(e,c,3),c+=2,fe=z[L-1]):A==17?(he=3+Fe(e,c,7),c+=3):A==18&&(he=11+Fe(e,c,127),c+=7);he--;)z[L++]=fe}}var de=z.subarray(0,g),Ue=z.subarray(g);w=Vn(de),U=Vn(Ue),m=Kt(de,w,1),S=Kt(Ue,U,1)}else throw"invalid block type";else{var A=Xo(c)+4,P=e[A-4]|e[A-3]<<8,E=A+P;if(E>i){if(o)throw"unexpected EOF";break}s&&l(h+P),t.set(e.subarray(A,E),h),n.b=h+=P,n.p=c=E*8;continue}if(c>C){if(o)throw"unexpected EOF";break}}s&&l(h+131072);for(var be=(1<<w)-1,Te=(1<<U)-1,nt=c;;nt=c){var fe=m[Zn(e,c)&be],Ee=fe>>>4;if(c+=fe&15,c>C){if(o)throw"unexpected EOF";break}if(!fe)throw"invalid length/literal";if(Ee<256)t[h++]=Ee;else if(Ee==256){nt=c,m=null;break}else{var wt=Ee-254;if(Ee>264){var L=Ee-257,Me=ns[L];wt=Fe(e,c,(1<<Me)-1)+as[L],c+=Me}var pt=S[Zn(e,c)&Te],mt=pt>>>4;if(!pt)throw"invalid distance";c+=pt&15;var Ue=$o[mt];if(mt>3){var Me=is[mt];Ue+=Zn(e,c)&(1<<Me)-1,c+=Me}if(c>C){if(o)throw"unexpected EOF";break}s&&l(h+131072);for(var Ot=h+wt;h<Ot;h+=4)t[h]=t[h-Ue],t[h+1]=t[h+1-Ue],t[h+2]=t[h+2-Ue],t[h+3]=t[h+3-Ue];h=Ot}}n.l=m,n.p=nt,n.b=h,m&&(f=1,n.m=w,n.d=S,n.n=U)}while(!f);return h==t.length?t:Qo(t,0,h)},Yo=new Ne(0),Jo=function(e){if((e[0]&15)!=8||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(e[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function Sn(e,t){return Ko((Jo(e),e.subarray(2,-4)),t)}var el=typeof TextDecoder<"u"&&new TextDecoder,tl=0;try{el.decode(Yo,{stream:!0}),tl=1}catch{}const nl=e=>e&&e.isCubeTexture;class il extends gr{constructor(t,n){var i,s;const o=nl(t),f=((s=o?(i=t.image[0])==null?void 0:i.width:t.image.width)!=null?s:1024)/4,c=Math.floor(Math.log2(f)),h=Math.pow(2,c),m=3*Math.max(h,16*7),S=4*h,w=[o?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/m}`,`#define CUBEUV_TEXEL_HEIGHT ${1/S}`,`#define CUBEUV_MAX_MIP ${c}.0`],U=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,C=w.join(`
`)+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${parseInt(An.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `,B={map:{value:t},height:{value:n?.height||15},radius:{value:n?.radius||100}},A=new ea(1,16),P=new qe({uniforms:B,fragmentShader:C,vertexShader:U,side:$t});super(A,P)}set radius(t){this.material.uniforms.radius.value=t}get radius(){return this.material.uniforms.radius.value}set height(t){this.material.uniforms.height.value=t}get height(){return this.material.uniforms.height.value}}class rl extends Sr{constructor(t){super(t),this.type=$e}parse(t){const f=function(g,y){switch(g){case 1:console.error("THREE.RGBELoader Read Error: "+(y||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(y||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(y||""));break;default:case 4:console.error("THREE.RGBELoader: Error: "+(y||""))}return-1},S=`
`,w=function(g,y,k){y=y||1024;let Z=g.pos,L=-1,F=0,G="",N=String.fromCharCode.apply(null,new Uint16Array(g.subarray(Z,Z+128)));for(;0>(L=N.indexOf(S))&&F<y&&Z<g.byteLength;)G+=N,F+=N.length,Z+=128,N+=String.fromCharCode.apply(null,new Uint16Array(g.subarray(Z,Z+128)));return-1<L?(k!==!1&&(g.pos+=F+L+1),G+N.slice(0,L)):!1},U=function(g){const y=/^#\?(\S+)/,k=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,z=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,Z=/^\s*FORMAT=(\S+)\s*$/,L=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,F={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let G,N;if(g.pos>=g.byteLength||!(G=w(g)))return f(1,"no header found");if(!(N=G.match(y)))return f(3,"bad initial token");for(F.valid|=1,F.programtype=N[1],F.string+=G+`
`;G=w(g),G!==!1;){if(F.string+=G+`
`,G.charAt(0)==="#"){F.comments+=G+`
`;continue}if((N=G.match(k))&&(F.gamma=parseFloat(N[1])),(N=G.match(z))&&(F.exposure=parseFloat(N[1])),(N=G.match(Z))&&(F.valid|=2,F.format=N[1]),(N=G.match(L))&&(F.valid|=4,F.height=parseInt(N[1],10),F.width=parseInt(N[2],10)),F.valid&2&&F.valid&4)break}return F.valid&2?F.valid&4?F:f(3,"missing image size specifier"):f(3,"missing format specifier")},C=function(g,y,k){const z=y;if(z<8||z>32767||g[0]!==2||g[1]!==2||g[2]&128)return new Uint8Array(g);if(z!==(g[2]<<8|g[3]))return f(3,"wrong scanline width");const Z=new Uint8Array(4*y*k);if(!Z.length)return f(4,"unable to allocate buffer space");let L=0,F=0;const G=4*z,N=new Uint8Array(4),W=new Uint8Array(G);let fe=k;for(;fe>0&&F<g.byteLength;){if(F+4>g.byteLength)return f(1);if(N[0]=g[F++],N[1]=g[F++],N[2]=g[F++],N[3]=g[F++],N[0]!=2||N[1]!=2||(N[2]<<8|N[3])!=z)return f(3,"bad rgbe scanline format");let he=0,de;for(;he<G&&F<g.byteLength;){de=g[F++];const be=de>128;if(be&&(de-=128),de===0||he+de>G)return f(3,"bad scanline data");if(be){const Te=g[F++];for(let nt=0;nt<de;nt++)W[he++]=Te}else W.set(g.subarray(F,F+de),he),he+=de,F+=de}const Ue=z;for(let be=0;be<Ue;be++){let Te=0;Z[L]=W[be+Te],Te+=z,Z[L+1]=W[be+Te],Te+=z,Z[L+2]=W[be+Te],Te+=z,Z[L+3]=W[be+Te],L+=4}fe--}return Z},B=function(g,y,k,z){const Z=g[y+3],L=Math.pow(2,Z-128)/255;k[z+0]=g[y+0]*L,k[z+1]=g[y+1]*L,k[z+2]=g[y+2]*L,k[z+3]=1},A=function(g,y,k,z){const Z=g[y+3],L=Math.pow(2,Z-128)/255;k[z+0]=Mt.toHalfFloat(Math.min(g[y+0]*L,65504)),k[z+1]=Mt.toHalfFloat(Math.min(g[y+1]*L,65504)),k[z+2]=Mt.toHalfFloat(Math.min(g[y+2]*L,65504)),k[z+3]=Mt.toHalfFloat(1)},P=new Uint8Array(t);P.pos=0;const E=U(P);if(E!==-1){const g=E.width,y=E.height,k=C(P.subarray(P.pos),g,y);if(k!==-1){let z,Z,L;switch(this.type){case _t:L=k.length/4;const F=new Float32Array(L*4);for(let N=0;N<L;N++)B(k,N*4,F,N*4);z=F,Z=_t;break;case $e:L=k.length/4;const G=new Uint16Array(L*4);for(let N=0;N<L;N++)A(k,N*4,G,N*4);z=G,Z=$e;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type);break}return{width:g,height:y,data:z,header:E.string,gamma:E.gamma,exposure:E.exposure,type:Z}}}return null}setDataType(t){return this.type=t,this}load(t,n,i,s){function o(l,f){switch(l.type){case _t:case $e:"colorSpace"in l?l.colorSpace="srgb-linear":l.encoding=3e3,l.minFilter=dt,l.magFilter=dt,l.generateMipmaps=!1,l.flipY=!0;break}n&&n(l,f)}return super.load(t,o,i,s)}}const Wt="colorSpace"in new ui;class sl extends Sr{constructor(t){super(t),this.type=$e}parse(t){const F=Math.pow(2.7182818,2.2);function G(r,a){for(var u=0,d=0;d<65536;++d)(d==0||r[d>>3]&1<<(d&7))&&(a[u++]=d);for(var v=u-1;u<65536;)a[u++]=0;return v}function N(r){for(var a=0;a<16384;a++)r[a]={},r[a].len=0,r[a].lit=0,r[a].p=null}const W={l:0,c:0,lc:0};function fe(r,a,u,d,v){for(;u<r;)a=a<<8|zi(d,v),u+=8;u-=r,W.l=a>>u&(1<<r)-1,W.c=a,W.lc=u}const he=new Array(59);function de(r){for(var a=0;a<=58;++a)he[a]=0;for(var a=0;a<65537;++a)he[r[a]]+=1;for(var u=0,a=58;a>0;--a){var d=u+he[a]>>1;he[a]=u,u=d}for(var a=0;a<65537;++a){var v=r[a];v>0&&(r[a]=v|he[v]++<<6)}}function Ue(r,a,u,d,v,p,x){for(var _=u,M=0,T=0;v<=p;v++){if(_.value-u.value>d)return!1;fe(6,M,T,r,_);var I=W.l;if(M=W.c,T=W.lc,x[v]=I,I==63){if(_.value-u.value>d)throw"Something wrong with hufUnpackEncTable";fe(8,M,T,r,_);var b=W.l+6;if(M=W.c,T=W.lc,v+b>p+1)throw"Something wrong with hufUnpackEncTable";for(;b--;)x[v++]=0;v--}else if(I>=59){var b=I-59+2;if(v+b>p+1)throw"Something wrong with hufUnpackEncTable";for(;b--;)x[v++]=0;v--}}de(x)}function be(r){return r&63}function Te(r){return r>>6}function nt(r,a,u,d){for(;a<=u;a++){var v=Te(r[a]),p=be(r[a]);if(v>>p)throw"Invalid table entry";if(p>14){var x=d[v>>p-14];if(x.len)throw"Invalid table entry";if(x.lit++,x.p){var _=x.p;x.p=new Array(x.lit);for(var M=0;M<x.lit-1;++M)x.p[M]=_[M]}else x.p=new Array(1);x.p[x.lit-1]=a}else if(p)for(var T=0,M=1<<14-p;M>0;M--){var x=d[(v<<14-p)+T];if(x.len||x.p)throw"Invalid table entry";x.len=p,x.lit=a,T++}}return!0}const Ee={c:0,lc:0};function wt(r,a,u,d){r=r<<8|zi(u,d),a+=8,Ee.c=r,Ee.lc=a}const Me={c:0,lc:0};function pt(r,a,u,d,v,p,x,_,M,T){if(r==a){d<8&&(wt(u,d,v,x),u=Ee.c,d=Ee.lc),d-=8;var I=u>>d,I=new Uint8Array([I])[0];if(M.value+I>T)return!1;for(var b=_[M.value-1];I-- >0;)_[M.value++]=b}else if(M.value<T)_[M.value++]=r;else return!1;Me.c=u,Me.lc=d}function mt(r){return r&65535}function Ot(r){var a=mt(r);return a>32767?a-65536:a}const ne={a:0,b:0};function Xe(r,a){var u=Ot(r),d=Ot(a),v=d,p=u+(v&1)+(v>>1),x=p,_=p-v;ne.a=x,ne.b=_}function Qe(r,a){var u=mt(r),d=mt(a),v=u-(d>>1)&65535,p=d+v-32768&65535;ne.a=p,ne.b=v}function xs(r,a,u,d,v,p,x){for(var _=x<16384,M=u>v?v:u,T=1,I;T<=M;)T<<=1;for(T>>=1,I=T,T>>=1;T>=1;){for(var b=0,ce=b+p*(v-I),H=p*T,V=p*I,j=d*T,Q=d*I,ie,se,ve,we;b<=ce;b+=V){for(var ae=b,Ve=b+d*(u-I);ae<=Ve;ae+=Q){var oe=ae+j,pe=ae+H,Ke=pe+j;_?(Xe(r[ae+a],r[pe+a]),ie=ne.a,ve=ne.b,Xe(r[oe+a],r[Ke+a]),se=ne.a,we=ne.b,Xe(ie,se),r[ae+a]=ne.a,r[oe+a]=ne.b,Xe(ve,we),r[pe+a]=ne.a,r[Ke+a]=ne.b):(Qe(r[ae+a],r[pe+a]),ie=ne.a,ve=ne.b,Qe(r[oe+a],r[Ke+a]),se=ne.a,we=ne.b,Qe(ie,se),r[ae+a]=ne.a,r[oe+a]=ne.b,Qe(ve,we),r[pe+a]=ne.a,r[Ke+a]=ne.b)}if(u&T){var pe=ae+H;_?Xe(r[ae+a],r[pe+a]):Qe(r[ae+a],r[pe+a]),ie=ne.a,r[pe+a]=ne.b,r[ae+a]=ie}}if(v&T)for(var ae=b,Ve=b+d*(u-I);ae<=Ve;ae+=Q){var oe=ae+j;_?Xe(r[ae+a],r[oe+a]):Qe(r[ae+a],r[oe+a]),ie=ne.a,r[oe+a]=ne.b,r[ae+a]=ie}I=T,T>>=1}return b}function ys(r,a,u,d,v,p,x,_,M,T){for(var I=0,b=0,ce=_,H=Math.trunc(v.value+(p+7)/8);v.value<H;)for(wt(I,b,u,v),I=Ee.c,b=Ee.lc;b>=14;){var V=I>>b-14&16383,j=a[V];if(j.len)b-=j.len,pt(j.lit,x,I,b,u,d,v,M,T,ce),I=Me.c,b=Me.lc;else{if(!j.p)throw"hufDecode issues";var Q;for(Q=0;Q<j.lit;Q++){for(var ie=be(r[j.p[Q]]);b<ie&&v.value<H;)wt(I,b,u,v),I=Ee.c,b=Ee.lc;if(b>=ie&&Te(r[j.p[Q]])==(I>>b-ie&(1<<ie)-1)){b-=ie,pt(j.p[Q],x,I,b,u,d,v,M,T,ce),I=Me.c,b=Me.lc;break}}if(Q==j.lit)throw"hufDecode issues"}}var se=8-p&7;for(I>>=se,b-=se;b>0;){var j=a[I<<14-b&16383];if(j.len)b-=j.len,pt(j.lit,x,I,b,u,d,v,M,T,ce),I=Me.c,b=Me.lc;else throw"hufDecode issues"}return!0}function Ci(r,a,u,d,v,p){var x={value:0},_=u.value,M=Re(a,u),T=Re(a,u);u.value+=4;var I=Re(a,u);if(u.value+=4,M<0||M>=65537||T<0||T>=65537)throw"Something wrong with HUF_ENCSIZE";var b=new Array(65537),ce=new Array(16384);N(ce);var H=d-(u.value-_);if(Ue(r,a,u,H,M,T,b),I>8*(d-(u.value-_)))throw"Something wrong with hufUncompress";nt(b,M,T,ce),ys(b,ce,r,a,u,I,T,p,v,x)}function Es(r,a,u){for(var d=0;d<u;++d)a[d]=r[a[d]]}function Bi(r){for(var a=1;a<r.length;a++){var u=r[a-1]+r[a]-128;r[a]=u}}function Pi(r,a){for(var u=0,d=Math.floor((r.length+1)/2),v=0,p=r.length-1;!(v>p||(a[v++]=r[u++],v>p));)a[v++]=r[d++]}function Di(r){for(var a=r.byteLength,u=new Array,d=0,v=new DataView(r);a>0;){var p=v.getInt8(d++);if(p<0){var x=-p;a-=x+1;for(var _=0;_<x;_++)u.push(v.getUint8(d++))}else{var x=p;a-=2;for(var M=v.getUint8(d++),_=0;_<x+1;_++)u.push(M)}}return u}function ws(r,a,u,d,v,p){var oe=new DataView(p.buffer),x=u[r.idx[0]].width,_=u[r.idx[0]].height,M=3,T=Math.floor(x/8),I=Math.ceil(x/8),b=Math.ceil(_/8),ce=x-(I-1)*8,H=_-(b-1)*8,V={value:0},j=new Array(M),Q=new Array(M),ie=new Array(M),se=new Array(M),ve=new Array(M);for(let re=0;re<M;++re)ve[re]=a[r.idx[re]],j[re]=re<1?0:j[re-1]+I*b,Q[re]=new Float32Array(64),ie[re]=new Uint16Array(64),se[re]=new Uint16Array(I*64);for(let re=0;re<b;++re){var we=8;re==b-1&&(we=H);var ae=8;for(let ue=0;ue<I;++ue){ue==I-1&&(ae=ce);for(let te=0;te<M;++te)ie[te].fill(0),ie[te][0]=v[j[te]++],bs(V,d,ie[te]),Ts(ie[te],Q[te]),Ms(Q[te]);Rs(Q);for(let te=0;te<M;++te)As(Q[te],se[te],ue*64)}let xe=0;for(let ue=0;ue<M;++ue){const te=u[r.idx[ue]].type;for(let Pe=8*re;Pe<8*re+we;++Pe){xe=ve[ue][Pe];for(let gt=0;gt<T;++gt){const Ie=gt*64+(Pe&7)*8;oe.setUint16(xe+0*2*te,se[ue][Ie+0],!0),oe.setUint16(xe+1*2*te,se[ue][Ie+1],!0),oe.setUint16(xe+2*2*te,se[ue][Ie+2],!0),oe.setUint16(xe+3*2*te,se[ue][Ie+3],!0),oe.setUint16(xe+4*2*te,se[ue][Ie+4],!0),oe.setUint16(xe+5*2*te,se[ue][Ie+5],!0),oe.setUint16(xe+6*2*te,se[ue][Ie+6],!0),oe.setUint16(xe+7*2*te,se[ue][Ie+7],!0),xe+=8*2*te}}if(T!=I)for(let Pe=8*re;Pe<8*re+we;++Pe){const gt=ve[ue][Pe]+8*T*2*te,Ie=T*64+(Pe&7)*8;for(let it=0;it<ae;++it)oe.setUint16(gt+it*2*te,se[ue][Ie+it],!0)}}}for(var Ve=new Uint16Array(x),oe=new DataView(p.buffer),pe=0;pe<M;++pe){u[r.idx[pe]].decoded=!0;var Ke=u[r.idx[pe]].type;if(u[pe].type==2)for(var kt=0;kt<_;++kt){const re=ve[pe][kt];for(var Be=0;Be<x;++Be)Ve[Be]=oe.getUint16(re+Be*2*Ke,!0);for(var Be=0;Be<x;++Be)oe.setFloat32(re+Be*2*Ke,O(Ve[Be]),!0)}}}function bs(r,a,u){for(var d,v=1;v<64;)d=a[r.value],d==65280?v=64:d>>8==255?v+=d&255:(u[v]=d,v++),r.value++}function Ts(r,a){a[0]=O(r[0]),a[1]=O(r[1]),a[2]=O(r[5]),a[3]=O(r[6]),a[4]=O(r[14]),a[5]=O(r[15]),a[6]=O(r[27]),a[7]=O(r[28]),a[8]=O(r[2]),a[9]=O(r[4]),a[10]=O(r[7]),a[11]=O(r[13]),a[12]=O(r[16]),a[13]=O(r[26]),a[14]=O(r[29]),a[15]=O(r[42]),a[16]=O(r[3]),a[17]=O(r[8]),a[18]=O(r[12]),a[19]=O(r[17]),a[20]=O(r[25]),a[21]=O(r[30]),a[22]=O(r[41]),a[23]=O(r[43]),a[24]=O(r[9]),a[25]=O(r[11]),a[26]=O(r[18]),a[27]=O(r[24]),a[28]=O(r[31]),a[29]=O(r[40]),a[30]=O(r[44]),a[31]=O(r[53]),a[32]=O(r[10]),a[33]=O(r[19]),a[34]=O(r[23]),a[35]=O(r[32]),a[36]=O(r[39]),a[37]=O(r[45]),a[38]=O(r[52]),a[39]=O(r[54]),a[40]=O(r[20]),a[41]=O(r[22]),a[42]=O(r[33]),a[43]=O(r[38]),a[44]=O(r[46]),a[45]=O(r[51]),a[46]=O(r[55]),a[47]=O(r[60]),a[48]=O(r[21]),a[49]=O(r[34]),a[50]=O(r[37]),a[51]=O(r[47]),a[52]=O(r[50]),a[53]=O(r[56]),a[54]=O(r[59]),a[55]=O(r[61]),a[56]=O(r[35]),a[57]=O(r[36]),a[58]=O(r[48]),a[59]=O(r[49]),a[60]=O(r[57]),a[61]=O(r[58]),a[62]=O(r[62]),a[63]=O(r[63])}function Ms(r){const a=.5*Math.cos(.7853975),u=.5*Math.cos(3.14159/16),d=.5*Math.cos(3.14159/8),v=.5*Math.cos(3*3.14159/16),p=.5*Math.cos(5*3.14159/16),x=.5*Math.cos(3*3.14159/8),_=.5*Math.cos(7*3.14159/16);for(var M=new Array(4),T=new Array(4),I=new Array(4),b=new Array(4),ce=0;ce<8;++ce){var H=ce*8;M[0]=d*r[H+2],M[1]=x*r[H+2],M[2]=d*r[H+6],M[3]=x*r[H+6],T[0]=u*r[H+1]+v*r[H+3]+p*r[H+5]+_*r[H+7],T[1]=v*r[H+1]-_*r[H+3]-u*r[H+5]-p*r[H+7],T[2]=p*r[H+1]-u*r[H+3]+_*r[H+5]+v*r[H+7],T[3]=_*r[H+1]-p*r[H+3]+v*r[H+5]-u*r[H+7],I[0]=a*(r[H+0]+r[H+4]),I[3]=a*(r[H+0]-r[H+4]),I[1]=M[0]+M[3],I[2]=M[1]-M[2],b[0]=I[0]+I[1],b[1]=I[3]+I[2],b[2]=I[3]-I[2],b[3]=I[0]-I[1],r[H+0]=b[0]+T[0],r[H+1]=b[1]+T[1],r[H+2]=b[2]+T[2],r[H+3]=b[3]+T[3],r[H+4]=b[3]-T[3],r[H+5]=b[2]-T[2],r[H+6]=b[1]-T[1],r[H+7]=b[0]-T[0]}for(var V=0;V<8;++V)M[0]=d*r[16+V],M[1]=x*r[16+V],M[2]=d*r[48+V],M[3]=x*r[48+V],T[0]=u*r[8+V]+v*r[24+V]+p*r[40+V]+_*r[56+V],T[1]=v*r[8+V]-_*r[24+V]-u*r[40+V]-p*r[56+V],T[2]=p*r[8+V]-u*r[24+V]+_*r[40+V]+v*r[56+V],T[3]=_*r[8+V]-p*r[24+V]+v*r[40+V]-u*r[56+V],I[0]=a*(r[V]+r[32+V]),I[3]=a*(r[V]-r[32+V]),I[1]=M[0]+M[3],I[2]=M[1]-M[2],b[0]=I[0]+I[1],b[1]=I[3]+I[2],b[2]=I[3]-I[2],b[3]=I[0]-I[1],r[0+V]=b[0]+T[0],r[8+V]=b[1]+T[1],r[16+V]=b[2]+T[2],r[24+V]=b[3]+T[3],r[32+V]=b[3]-T[3],r[40+V]=b[2]-T[2],r[48+V]=b[1]-T[1],r[56+V]=b[0]-T[0]}function Rs(r){for(var a=0;a<64;++a){var u=r[0][a],d=r[1][a],v=r[2][a];r[0][a]=u+1.5747*v,r[1][a]=u-.1873*d-.4682*v,r[2][a]=u+1.8556*d}}function As(r,a,u){for(var d=0;d<64;++d)a[u+d]=Mt.toHalfFloat(Is(r[d]))}function Is(r){return r<=1?Math.sign(r)*Math.pow(Math.abs(r),2.2):Math.sign(r)*Math.pow(F,Math.abs(r)-1)}function Oi(r){return new DataView(r.array.buffer,r.offset.value,r.size)}function Us(r){var a=r.viewer.buffer.slice(r.offset.value,r.offset.value+r.size),u=new Uint8Array(Di(a)),d=new Uint8Array(u.length);return Bi(u),Pi(u,d),new DataView(d.buffer)}function zn(r){var a=r.array.slice(r.offset.value,r.offset.value+r.size),u=Sn(a),d=new Uint8Array(u.length);return Bi(u),Pi(u,d),new DataView(d.buffer)}function Cs(r){for(var a=r.viewer,u={value:r.offset.value},d=new Uint16Array(r.width*r.scanlineBlockSize*(r.channels*r.type)),v=new Uint8Array(8192),p=0,x=new Array(r.channels),_=0;_<r.channels;_++)x[_]={},x[_].start=p,x[_].end=x[_].start,x[_].nx=r.width,x[_].ny=r.lines,x[_].size=r.type,p+=x[_].nx*x[_].ny*x[_].size;var M=zt(a,u),T=zt(a,u);if(T>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(M<=T)for(var _=0;_<T-M+1;_++)v[_+M]=bt(a,u);var I=new Uint16Array(65536),b=G(v,I),ce=Re(a,u);Ci(r.array,a,u,ce,d,p);for(var _=0;_<r.channels;++_)for(var H=x[_],V=0;V<x[_].size;++V)xs(d,H.start+V,H.nx,H.size,H.ny,H.nx*H.size,b);Es(I,d,p);for(var j=0,Q=new Uint8Array(d.buffer.byteLength),ie=0;ie<r.lines;ie++)for(var se=0;se<r.channels;se++){var H=x[se],ve=H.nx*H.size,we=new Uint8Array(d.buffer,H.end*2,ve*2);Q.set(we,j),j+=ve*2,H.end+=ve}return new DataView(Q.buffer)}function Bs(r){var a=r.array.slice(r.offset.value,r.offset.value+r.size),u=Sn(a);const d=r.lines*r.channels*r.width,v=r.type==1?new Uint16Array(d):new Uint32Array(d);let p=0,x=0;const _=new Array(4);for(let M=0;M<r.lines;M++)for(let T=0;T<r.channels;T++){let I=0;switch(r.type){case 1:_[0]=p,_[1]=_[0]+r.width,p=_[1]+r.width;for(let b=0;b<r.width;++b){const ce=u[_[0]++]<<8|u[_[1]++];I+=ce,v[x]=I,x++}break;case 2:_[0]=p,_[1]=_[0]+r.width,_[2]=_[1]+r.width,p=_[2]+r.width;for(let b=0;b<r.width;++b){const ce=u[_[0]++]<<24|u[_[1]++]<<16|u[_[2]++]<<8;I+=ce,v[x]=I,x++}break}}return new DataView(v.buffer)}function Ni(r){var a=r.viewer,u={value:r.offset.value},d=new Uint8Array(r.width*r.lines*(r.channels*r.type*2)),v={version:Ce(a,u),unknownUncompressedSize:Ce(a,u),unknownCompressedSize:Ce(a,u),acCompressedSize:Ce(a,u),dcCompressedSize:Ce(a,u),rleCompressedSize:Ce(a,u),rleUncompressedSize:Ce(a,u),rleRawSize:Ce(a,u),totalAcUncompressedCount:Ce(a,u),totalDcUncompressedCount:Ce(a,u),acCompression:Ce(a,u)};if(v.version<2)throw"EXRLoader.parse: "+Ft.compression+" version "+v.version+" is unsupported";for(var p=new Array,x=zt(a,u)-2;x>0;){var _=cn(a.buffer,u),M=bt(a,u),T=M>>2&3,I=(M>>4)-1,b=new Int8Array([I])[0],ce=bt(a,u);p.push({name:_,index:b,type:ce,compression:T}),x-=_.length+3}for(var H=Ft.channels,V=new Array(r.channels),j=0;j<r.channels;++j){var Q=V[j]={},ie=H[j];Q.name=ie.name,Q.compression=0,Q.decoded=!1,Q.type=ie.pixelType,Q.pLinear=ie.pLinear,Q.width=r.width,Q.height=r.lines}for(var se={idx:new Array(3)},ve=0;ve<r.channels;++ve)for(var Q=V[ve],j=0;j<p.length;++j){var we=p[j];Q.name==we.name&&(Q.compression=we.compression,we.index>=0&&(se.idx[we.index]=ve),Q.offset=ve)}if(v.acCompressedSize>0)switch(v.acCompression){case 0:var oe=new Uint16Array(v.totalAcUncompressedCount);Ci(r.array,a,u,v.acCompressedSize,oe,v.totalAcUncompressedCount);break;case 1:var ae=r.array.slice(u.value,u.value+v.totalAcUncompressedCount),Ve=Sn(ae),oe=new Uint16Array(Ve.buffer);u.value+=v.totalAcUncompressedCount;break}if(v.dcCompressedSize>0){var pe={array:r.array,offset:u,size:v.dcCompressedSize},Ke=new Uint16Array(zn(pe).buffer);u.value+=v.dcCompressedSize}if(v.rleRawSize>0){var ae=r.array.slice(u.value,u.value+v.rleCompressedSize),Ve=Sn(ae),kt=Di(Ve.buffer);u.value+=v.rleCompressedSize}for(var Be=0,re=new Array(V.length),j=0;j<re.length;++j)re[j]=new Array;for(var xe=0;xe<r.lines;++xe)for(var ue=0;ue<V.length;++ue)re[ue].push(Be),Be+=V[ue].width*r.type*2;ws(se,re,V,oe,Ke,d);for(var j=0;j<V.length;++j){var Q=V[j];if(!Q.decoded)switch(Q.compression){case 2:for(var te=0,Pe=0,xe=0;xe<r.lines;++xe){for(var gt=re[j][te],Ie=0;Ie<Q.width;++Ie){for(var it=0;it<2*Q.type;++it)d[gt++]=kt[Pe+it*Q.width*Q.height];Pe++}te++}break;case 1:default:throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(d.buffer)}function cn(r,a){for(var u=new Uint8Array(r),d=0;u[a.value+d]!=0;)d+=1;var v=new TextDecoder().decode(u.slice(a.value,a.value+d));return a.value=a.value+d+1,v}function Ps(r,a,u){var d=new TextDecoder().decode(new Uint8Array(r).slice(a.value,a.value+u));return a.value=a.value+u,d}function Ds(r,a){var u=Nt(r,a),d=Re(r,a);return[u,d]}function Os(r,a){var u=Re(r,a),d=Re(r,a);return[u,d]}function Nt(r,a){var u=r.getInt32(a.value,!0);return a.value=a.value+4,u}function Re(r,a){var u=r.getUint32(a.value,!0);return a.value=a.value+4,u}function zi(r,a){var u=r[a.value];return a.value=a.value+1,u}function bt(r,a){var u=r.getUint8(a.value);return a.value=a.value+1,u}const Ce=function(r,a){let u;return"getBigInt64"in DataView.prototype?u=Number(r.getBigInt64(a.value,!0)):u=r.getUint32(a.value+4,!0)+Number(r.getUint32(a.value,!0)<<32),a.value+=8,u};function _e(r,a){var u=r.getFloat32(a.value,!0);return a.value+=4,u}function Ns(r,a){return Mt.toHalfFloat(_e(r,a))}function O(r){var a=(r&31744)>>10,u=r&1023;return(r>>15?-1:1)*(a?a===31?u?NaN:1/0:Math.pow(2,a-15)*(1+u/1024):6103515625e-14*(u/1024))}function zt(r,a){var u=r.getUint16(a.value,!0);return a.value+=2,u}function zs(r,a){return O(zt(r,a))}function Ls(r,a,u,d){for(var v=u.value,p=[];u.value<v+d-1;){var x=cn(a,u),_=Nt(r,u),M=bt(r,u);u.value+=3;var T=Nt(r,u),I=Nt(r,u);p.push({name:x,pixelType:_,pLinear:M,xSampling:T,ySampling:I})}return u.value+=1,p}function Fs(r,a){var u=_e(r,a),d=_e(r,a),v=_e(r,a),p=_e(r,a),x=_e(r,a),_=_e(r,a),M=_e(r,a),T=_e(r,a);return{redX:u,redY:d,greenX:v,greenY:p,blueX:x,blueY:_,whiteX:M,whiteY:T}}function ks(r,a){var u=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],d=bt(r,a);return u[d]}function Hs(r,a){var u=Re(r,a),d=Re(r,a),v=Re(r,a),p=Re(r,a);return{xMin:u,yMin:d,xMax:v,yMax:p}}function Gs(r,a){var u=["INCREASING_Y"],d=bt(r,a);return u[d]}function Vs(r,a){var u=_e(r,a),d=_e(r,a);return[u,d]}function Zs(r,a){var u=_e(r,a),d=_e(r,a),v=_e(r,a);return[u,d,v]}function Ws(r,a,u,d,v){if(d==="string"||d==="stringvector"||d==="iccProfile")return Ps(a,u,v);if(d==="chlist")return Ls(r,a,u,v);if(d==="chromaticities")return Fs(r,u);if(d==="compression")return ks(r,u);if(d==="box2i")return Hs(r,u);if(d==="lineOrder")return Gs(r,u);if(d==="float")return _e(r,u);if(d==="v2f")return Vs(r,u);if(d==="v3f")return Zs(r,u);if(d==="int")return Nt(r,u);if(d==="rational")return Ds(r,u);if(d==="timecode")return Os(r,u);if(d==="preview")return u.value+=v,"skipped";u.value+=v}function $s(r,a,u){const d={};if(r.getUint32(0,!0)!=20000630)throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";d.version=r.getUint8(4);const v=r.getUint8(5);d.spec={singleTile:!!(v&2),longName:!!(v&4),deepFormat:!!(v&8),multiPart:!!(v&16)},u.value=8;for(var p=!0;p;){var x=cn(a,u);if(x==0)p=!1;else{var _=cn(a,u),M=Re(r,u),T=Ws(r,a,u,_,M);T===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${_}'.`):d[x]=T}}if(v!=0)throw console.error("EXRHeader:",d),"THREE.EXRLoader: provided file is currently unsupported.";return d}function js(r,a,u,d,v){const p={size:0,viewer:a,array:u,offset:d,width:r.dataWindow.xMax-r.dataWindow.xMin+1,height:r.dataWindow.yMax-r.dataWindow.yMin+1,channels:r.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:r.channels[0].pixelType,uncompress:null,getter:null,format:null,[Wt?"colorSpace":"encoding"]:null};switch(r.compression){case"NO_COMPRESSION":p.lines=1,p.uncompress=Oi;break;case"RLE_COMPRESSION":p.lines=1,p.uncompress=Us;break;case"ZIPS_COMPRESSION":p.lines=1,p.uncompress=zn;break;case"ZIP_COMPRESSION":p.lines=16,p.uncompress=zn;break;case"PIZ_COMPRESSION":p.lines=32,p.uncompress=Cs;break;case"PXR24_COMPRESSION":p.lines=16,p.uncompress=Bs;break;case"DWAA_COMPRESSION":p.lines=32,p.uncompress=Ni;break;case"DWAB_COMPRESSION":p.lines=256,p.uncompress=Ni;break;default:throw"EXRLoader.parse: "+r.compression+" is unsupported"}if(p.scanlineBlockSize=p.lines,p.type==1)switch(v){case _t:p.getter=zs,p.inputSize=2;break;case $e:p.getter=zt,p.inputSize=2;break}else if(p.type==2)switch(v){case _t:p.getter=_e,p.inputSize=4;break;case $e:p.getter=Ns,p.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+p.type+" for "+r.compression+".";p.blockCount=(r.dataWindow.yMax+1)/p.scanlineBlockSize;for(var x=0;x<p.blockCount;x++)Ce(a,d);p.outputChannels=p.channels==3?4:p.channels;const _=p.width*p.height*p.outputChannels;switch(v){case _t:p.byteArray=new Float32Array(_),p.channels<p.outputChannels&&p.byteArray.fill(1,0,_);break;case $e:p.byteArray=new Uint16Array(_),p.channels<p.outputChannels&&p.byteArray.fill(15360,0,_);break;default:console.error("THREE.EXRLoader: unsupported type: ",v);break}return p.bytesPerLine=p.width*p.inputSize*p.channels,p.outputChannels==4?p.format=ta:p.format=na,Wt?p.colorSpace="srgb-linear":p.encoding=3e3,p}const fn=new DataView(t),qs=new Uint8Array(t),Lt={value:0},Ft=$s(fn,t,Lt),Y=js(Ft,fn,qs,Lt,this.type),Li={value:0},Xs={R:0,G:1,B:2,A:3,Y:0};for(let r=0;r<Y.height/Y.scanlineBlockSize;r++){const a=Re(fn,Lt);Y.size=Re(fn,Lt),Y.lines=a+Y.scanlineBlockSize>Y.height?Y.height-a:Y.scanlineBlockSize;const d=Y.size<Y.lines*Y.bytesPerLine?Y.uncompress(Y):Oi(Y);Lt.value+=Y.size;for(let v=0;v<Y.scanlineBlockSize;v++){const p=v+r*Y.scanlineBlockSize;if(p>=Y.height)break;for(let x=0;x<Y.channels;x++){const _=Xs[Ft.channels[x].name];for(let M=0;M<Y.width;M++){Li.value=(v*(Y.channels*Y.width)+x*Y.width+M)*Y.inputSize;const T=(Y.height-1-p)*(Y.width*Y.outputChannels)+M*Y.outputChannels+_;Y.byteArray[T]=Y.getter(d,Li)}}}}return{header:Ft,width:Y.width,height:Y.height,data:Y.byteArray,format:Y.format,[Wt?"colorSpace":"encoding"]:Y[Wt?"colorSpace":"encoding"],type:this.type}}setDataType(t){return this.type=t,this}load(t,n,i,s){function o(l,f){Wt?l.colorSpace=f.colorSpace:l.encoding=f.encoding,l.minFilter=dt,l.magFilter=dt,l.generateMipmaps=!1,l.flipY=!1,n&&n(l,f)}return super.load(t,o,i,s)}}const Wn={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},al="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",cr=e=>Array.isArray(e);function ls({files:e=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"],path:t="",preset:n=void 0,encoding:i=void 0,extensions:s}={}){var o;let l=null,f=!1,c;if(n){if(!(n in Wn))throw new Error("Preset must be one of: "+Object.keys(Wn).join(", "));e=Wn[n],t=al}if(f=cr(e),c=cr(e)?"cube":e.startsWith("data:application/exr")?"exr":e.startsWith("data:application/hdr")?"hdr":(o=e.split(".").pop())==null||(o=o.split("?"))==null||(o=o.shift())==null?void 0:o.toLowerCase(),l=f?aa:c==="hdr"?rl:c==="exr"?sl:null,!l)throw new Error("useEnvironment: Unrecognized file extension: "+e);const h=ia(l,f?[e]:e,U=>{U.setPath==null||U.setPath(t),s&&s(U)}),m=f?h[0]:h;m.mapping=f?ra:sa;const S=3001,w=3e3;return"colorSpace"in m?m.colorSpace=i??f?"srgb":"srgb-linear":m.encoding=i??f?S:w,m}const ol=e=>e.current&&e.current.isScene,ll=e=>ol(e)?e.current:e;function Ri(e,t,n,i,s=0){const o=ll(t||n),l=o.background,f=o.environment,c=o.backgroundBlurriness||0;return e!=="only"&&(o.environment=i),e&&(o.background=i),e&&o.backgroundBlurriness!==void 0&&(o.backgroundBlurriness=s),()=>{e!=="only"&&(o.environment=f),e&&(o.background=l),e&&o.backgroundBlurriness!==void 0&&(o.backgroundBlurriness=c)}}function Ai({scene:e,background:t=!1,blur:n,map:i}){const s=et(o=>o.scene);return D.useLayoutEffect(()=>{if(i)return Ri(t,e,s,i,n)},[s,e,i,t,n]),null}function us({background:e=!1,scene:t,blur:n,...i}){const s=ls(i),o=et(l=>l.scene);return D.useLayoutEffect(()=>Ri(e,t,o,s,n),[s,e,t,o,n]),null}function ul({children:e,near:t=1,far:n=1e3,resolution:i=256,frames:s=1,map:o,background:l=!1,blur:f,scene:c,files:h,path:m,preset:S=void 0,extensions:w}){const U=et(g=>g.gl),C=et(g=>g.scene),B=D.useRef(null),[A]=D.useState(()=>new qn),P=D.useMemo(()=>{const g=new oa(i);return g.texture.type=$e,g},[i]);D.useLayoutEffect(()=>(s===1&&B.current.update(U,A),Ri(l,c,C,P.texture,f)),[e,A,P.texture,c,C,l,s,U]);let E=1;return _r(()=>{(s===1/0||E<s)&&(B.current.update(U,A),E++)}),D.createElement(D.Fragment,null,la(D.createElement(D.Fragment,null,e,D.createElement("cubeCamera",{ref:B,args:[t,n,P]}),h||S?D.createElement(us,{background:!0,files:h,preset:S,path:m,extensions:w}):o?D.createElement(Ai,{background:!0,map:o,extensions:w}):null),A))}function cl(e){var t,n,i,s;const o=ls(e),l=e.map||o;D.useMemo(()=>xr({GroundProjectedEnvImpl:il}),[]);const f=D.useMemo(()=>[l],[l]),c=(t=e.ground)==null?void 0:t.height,h=(n=e.ground)==null?void 0:n.radius,m=(i=(s=e.ground)==null?void 0:s.scale)!==null&&i!==void 0?i:1e3;return D.createElement(D.Fragment,null,D.createElement(Ai,mr({},e,{map:l})),D.createElement("groundProjectedEnvImpl",{args:f,scale:m,height:c,radius:h}))}function fl(e){return e.ground?D.createElement(cl,e):e.map?D.createElement(Ai,e):e.children?D.createElement(ul,e):D.createElement(us,e)}/**
 * postprocessing v6.33.3 build Mon Oct 30 2023
 * https://github.com/pmndrs/postprocessing
 * Copyright 2015-2023 Raoul van Rüschen
 * @license Zlib
 */var hl=`#include <packing>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
uniform lowp sampler2D luminanceBuffer0;uniform lowp sampler2D luminanceBuffer1;uniform float minLuminance;uniform float deltaTime;uniform float tau;varying vec2 vUv;void main(){float l0=unpackRGBAToFloat(texture2D(luminanceBuffer0,vUv));
#if __VERSION__ < 300
float l1=texture2DLodEXT(luminanceBuffer1,vUv,MIP_LEVEL_1X1).r;
#else
float l1=textureLod(luminanceBuffer1,vUv,MIP_LEVEL_1X1).r;
#endif
l0=max(minLuminance,l0);l1=max(minLuminance,l1);float adaptedLum=l0+(l1-l0)*(1.0-exp(-deltaTime*tau));gl_FragColor=(adaptedLum==1.0)?vec4(1.0):packFloatToRGBA(adaptedLum);}`,Ii="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",dl=class extends qe{constructor(){super({name:"AdaptiveLuminanceMaterial",defines:{MIP_LEVEL_1X1:"0.0"},uniforms:{luminanceBuffer0:new q(null),luminanceBuffer1:new q(null),minLuminance:new q(.01),deltaTime:new q(0),tau:new q(1)},extensions:{shaderTextureLOD:!0},blending:vt,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:hl,vertexShader:Ii})}set luminanceBuffer0(e){this.uniforms.luminanceBuffer0.value=e}setLuminanceBuffer0(e){this.uniforms.luminanceBuffer0.value=e}set luminanceBuffer1(e){this.uniforms.luminanceBuffer1.value=e}setLuminanceBuffer1(e){this.uniforms.luminanceBuffer1.value=e}set mipLevel1x1(e){this.defines.MIP_LEVEL_1X1=e.toFixed(1),this.needsUpdate=!0}setMipLevel1x1(e){this.mipLevel1x1=e}set deltaTime(e){this.uniforms.deltaTime.value=e}setDeltaTime(e){this.uniforms.deltaTime.value=e}get minLuminance(){return this.uniforms.minLuminance.value}set minLuminance(e){this.uniforms.minLuminance.value=e}getMinLuminance(){return this.uniforms.minLuminance.value}setMinLuminance(e){this.uniforms.minLuminance.value=e}get adaptationRate(){return this.uniforms.tau.value}set adaptationRate(e){this.uniforms.tau.value=e}getAdaptationRate(){return this.uniforms.tau.value}setAdaptationRate(e){this.uniforms.tau.value=e}},X={SKIP:9,SET:30,ADD:0,ALPHA:1,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},cs="",me="srgb",Nn="srgb-linear",Ge={NONE:0,DEPTH:1,CONVOLUTION:2},J={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},Ui={VERY_SMALL:0,SMALL:1,MEDIUM:2,LARGE:3,VERY_LARGE:4,HUGE:5},Ye={REINHARD:0,REINHARD2:1,REINHARD2_ADAPTIVE:2,OPTIMIZED_CINEON:3,ACES_FILMIC:4,UNCHARTED2:5},fs=Number(An.replace(/\D+/g,"")),hs=fs>=152,vl=new Map([[wr,Nn],[br,me]]),pl=new Map([[Nn,wr],[me,br]]);function Bt(e){return e===null?null:hs?e.outputColorSpace:vl.get(e.outputEncoding)}function ht(e,t){e!==null&&(hs?e.colorSpace=t:e.encoding=pl.get(t))}function un(e){return fs<154?e.replace("colorspace_fragment","encodings_fragment"):e}var ml=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <colorspace_fragment>
}`,gl="uniform vec4 texelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",Sl=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],_l=class extends qe{constructor(e=new Fi){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new q(null),texelSize:new q(new Fi),scale:new q(1),kernel:new q(0)},blending:vt,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:ml,vertexShader:gl}),this.fragmentShader=un(this.fragmentShader),this.setTexelSize(e.x,e.y),this.kernelSize=Ui.MEDIUM}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.inputBuffer=e}get kernelSequence(){return Sl[this.kernelSize]}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(){return this.uniforms.scale.value}setScale(e){this.uniforms.scale.value=e}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(e){this.uniforms.kernel.value=e}setKernel(e){this.kernel=e}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t,e*.5,t*.5)}setSize(e,t){const n=1/e,i=1/t;this.uniforms.texelSize.value.set(n,i,n*.5,i*.5)}},xl=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <colorspace_fragment>
#include <dithering_fragment>
}`,ds=class extends qe{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new q(null),opacity:new q(1)},blending:vt,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:xl,vertexShader:Ii}),this.fragmentShader=un(this.fragmentShader)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}getOpacity(e){return this.uniforms.opacity.value}setOpacity(e){this.uniforms.opacity.value=e}},yl=`#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
#ifdef DOWNSAMPLE_NORMALS
uniform lowp sampler2D normalBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}int findBestDepth(const in float samples[4]){float c=(samples[0]+samples[1]+samples[2]+samples[3])*0.25;float distances[4];distances[0]=abs(c-samples[0]);distances[1]=abs(c-samples[1]);distances[2]=abs(c-samples[2]);distances[3]=abs(c-samples[3]);float maxDistance=max(max(distances[0],distances[1]),max(distances[2],distances[3]));int remaining[3];int rejected[3];int i,j,k;for(i=0,j=0,k=0;i<4;++i){if(distances[i]<maxDistance){remaining[j++]=i;}else{rejected[k++]=i;}}for(;j<3;++j){remaining[j]=rejected[--k];}vec3 s=vec3(samples[remaining[0]],samples[remaining[1]],samples[remaining[2]]);c=(s.x+s.y+s.z)/3.0;distances[0]=abs(c-s.x);distances[1]=abs(c-s.y);distances[2]=abs(c-s.z);float minDistance=min(distances[0],min(distances[1],distances[2]));for(i=0;i<3;++i){if(distances[i]==minDistance){break;}}return remaining[i];}void main(){float d[4];d[0]=readDepth(vUv0);d[1]=readDepth(vUv1);d[2]=readDepth(vUv2);d[3]=readDepth(vUv3);int index=findBestDepth(d);
#ifdef DOWNSAMPLE_NORMALS
vec3 n[4];n[0]=texture2D(normalBuffer,vUv0).rgb;n[1]=texture2D(normalBuffer,vUv1).rgb;n[2]=texture2D(normalBuffer,vUv2).rgb;n[3]=texture2D(normalBuffer,vUv3).rgb;
#else
vec3 n[4];n[0]=vec3(0.0);n[1]=vec3(0.0);n[2]=vec3(0.0);n[3]=vec3(0.0);
#endif
gl_FragColor=vec4(n[index],d[index]);}`,El="uniform vec2 texelSize;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vUv0=uv;vUv1=vec2(uv.x,uv.y+texelSize.y);vUv2=vec2(uv.x+texelSize.x,uv.y);vUv3=uv+texelSize;gl_Position=vec4(position.xy,1.0,1.0);}",wl=class extends qe{constructor(){super({name:"DepthDownsamplingMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new q(null),normalBuffer:new q(null),texelSize:new q(new ye)},blending:vt,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:yl,vertexShader:El})}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=Pt){this.depthBuffer=e,this.depthPacking=t}set normalBuffer(e){this.uniforms.normalBuffer.value=e,e!==null?this.defines.DOWNSAMPLE_NORMALS="1":delete this.defines.DOWNSAMPLE_NORMALS,this.needsUpdate=!0}setNormalBuffer(e){this.normalBuffer=e}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t)}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}},bl=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#define WEIGHT_INNER 0.125
#define WEIGHT_OUTER 0.0555555
varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;float clampToBorder(const in vec2 uv){return float(uv.s>=0.0&&uv.s<=1.0&&uv.t>=0.0&&uv.t<=1.0);}void main(){vec4 c=vec4(0.0);vec4 w=WEIGHT_INNER*vec4(clampToBorder(vUv00),clampToBorder(vUv01),clampToBorder(vUv02),clampToBorder(vUv03));c+=w.x*texture2D(inputBuffer,vUv00);c+=w.y*texture2D(inputBuffer,vUv01);c+=w.z*texture2D(inputBuffer,vUv02);c+=w.w*texture2D(inputBuffer,vUv03);w=WEIGHT_OUTER*vec4(clampToBorder(vUv04),clampToBorder(vUv05),clampToBorder(vUv06),clampToBorder(vUv07));c+=w.x*texture2D(inputBuffer,vUv04);c+=w.y*texture2D(inputBuffer,vUv05);c+=w.z*texture2D(inputBuffer,vUv06);c+=w.w*texture2D(inputBuffer,vUv07);w=WEIGHT_OUTER*vec4(clampToBorder(vUv08),clampToBorder(vUv09),clampToBorder(vUv10),clampToBorder(vUv11));c+=w.x*texture2D(inputBuffer,vUv08);c+=w.y*texture2D(inputBuffer,vUv09);c+=w.z*texture2D(inputBuffer,vUv10);c+=w.w*texture2D(inputBuffer,vUv11);c+=WEIGHT_OUTER*texture2D(inputBuffer,vUv);gl_FragColor=c;
#include <colorspace_fragment>
}`,Tl="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;void main(){vUv=position.xy*0.5+0.5;vUv00=vUv+texelSize*vec2(-1.0,1.0);vUv01=vUv+texelSize*vec2(1.0,1.0);vUv02=vUv+texelSize*vec2(-1.0,-1.0);vUv03=vUv+texelSize*vec2(1.0,-1.0);vUv04=vUv+texelSize*vec2(-2.0,2.0);vUv05=vUv+texelSize*vec2(0.0,2.0);vUv06=vUv+texelSize*vec2(2.0,2.0);vUv07=vUv+texelSize*vec2(-2.0,0.0);vUv08=vUv+texelSize*vec2(2.0,0.0);vUv09=vUv+texelSize*vec2(-2.0,-2.0);vUv10=vUv+texelSize*vec2(0.0,-2.0);vUv11=vUv+texelSize*vec2(2.0,-2.0);gl_Position=vec4(position.xy,1.0,1.0);}",Ml=class extends qe{constructor(){super({name:"DownsamplingMaterial",uniforms:{inputBuffer:new q(null),texelSize:new q(new ye)},blending:vt,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:bl,vertexShader:Tl}),this.fragmentShader=un(this.fragmentShader)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}},Rl=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if THREE_REVISION >= 137
vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE color0.a=clamp(color0.a,0.0,1.0);gl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
}`,Al="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}",Il=class extends qe{constructor(e,t,n,i,s=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:An.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new q(null),depthBuffer:new q(null),resolution:new q(new ye),texelSize:new q(new ye),cameraNear:new q(.3),cameraFar:new q(1e3),aspect:new q(1),time:new q(0)},blending:vt,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:s}),e&&this.setShaderParts(e),t&&this.setDefines(t),n&&this.setUniforms(n),this.copyCameraSettings(i)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=Pt){this.depthBuffer=e,this.depthPacking=t}setShaderData(e){this.setShaderParts(e.shaderParts),this.setDefines(e.defines),this.setUniforms(e.uniforms),this.setExtensions(e.extensions)}setShaderParts(e){return this.fragmentShader=Rl.replace(J.FRAGMENT_HEAD,e.get(J.FRAGMENT_HEAD)||"").replace(J.FRAGMENT_MAIN_UV,e.get(J.FRAGMENT_MAIN_UV)||"").replace(J.FRAGMENT_MAIN_IMAGE,e.get(J.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader=Al.replace(J.VERTEX_HEAD,e.get(J.VERTEX_HEAD)||"").replace(J.VERTEX_MAIN_SUPPORT,e.get(J.VERTEX_MAIN_SUPPORT)||""),this.fragmentShader=un(this.fragmentShader),this.needsUpdate=!0,this}setDefines(e){for(const t of e.entries())this.defines[t[0]]=t[1];return this.needsUpdate=!0,this}setUniforms(e){for(const t of e.entries())this.uniforms[t[0]]=t[1];return this}setExtensions(e){this.extensions={};for(const t of e)this.extensions[t]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(e){this.encodeOutput!==e&&(e?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(e){return this.encodeOutput}setOutputEncodingEnabled(e){this.encodeOutput=e}get time(){return this.uniforms.time.value}set time(e){this.uniforms.time.value=e}setDeltaTime(e){this.uniforms.time.value+=e}adoptCameraSettings(e){this.copyCameraSettings(e)}copyCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof ma?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(e,t){const n=this.uniforms;n.resolution.value.set(e,t),n.texelSize.value.set(1/e,1/t),n.aspect.value=e/t}static get Section(){return J}},Ul=`#include <common>
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);l*=low*high;
#elif defined(THRESHOLD)
l=smoothstep(threshold,threshold+smoothing,l);
#endif
#ifdef COLOR
gl_FragColor=vec4(texel.rgb*l,l);
#else
gl_FragColor=vec4(l);
#endif
}`,Cl=class extends qe{constructor(e=!1,t=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:An.replace(/\D+/g,"")},uniforms:{inputBuffer:new q(null),threshold:new q(0),smoothing:new q(1),range:new q(null)},blending:vt,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Ul,vertexShader:Ii}),this.colorOutput=e,this.luminanceRange=t}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get threshold(){return this.uniforms.threshold.value}set threshold(e){this.smoothing>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=e}getThreshold(){return this.threshold}setThreshold(e){this.threshold=e}get smoothing(){return this.uniforms.smoothing.value}set smoothing(e){this.threshold>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=e}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(e){this.smoothing=e}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(e){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(e){e?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(e){return this.colorOutput}setColorOutputEnabled(e){this.colorOutput=e}get useRange(){return this.luminanceRange!==null}set useRange(e){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(e){e!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=e,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(e){this.luminanceRange=e}},Bl=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;uniform mediump sampler2D supportBuffer;
#else
uniform lowp sampler2D inputBuffer;uniform lowp sampler2D supportBuffer;
#endif
uniform float radius;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vec4 c=vec4(0.0);c+=texture2D(inputBuffer,vUv0)*0.0625;c+=texture2D(inputBuffer,vUv1)*0.125;c+=texture2D(inputBuffer,vUv2)*0.0625;c+=texture2D(inputBuffer,vUv3)*0.125;c+=texture2D(inputBuffer,vUv)*0.25;c+=texture2D(inputBuffer,vUv4)*0.125;c+=texture2D(inputBuffer,vUv5)*0.0625;c+=texture2D(inputBuffer,vUv6)*0.125;c+=texture2D(inputBuffer,vUv7)*0.0625;vec4 baseColor=texture2D(supportBuffer,vUv);gl_FragColor=mix(baseColor,c,radius);
#include <colorspace_fragment>
}`,Pl="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,1.0);vUv1=vUv+texelSize*vec2(0.0,1.0);vUv2=vUv+texelSize*vec2(1.0,1.0);vUv3=vUv+texelSize*vec2(-1.0,0.0);vUv4=vUv+texelSize*vec2(1.0,0.0);vUv5=vUv+texelSize*vec2(-1.0,-1.0);vUv6=vUv+texelSize*vec2(0.0,-1.0);vUv7=vUv+texelSize*vec2(1.0,-1.0);gl_Position=vec4(position.xy,1.0,1.0);}",Dl=class extends qe{constructor(){super({name:"UpsamplingMaterial",uniforms:{inputBuffer:new q(null),supportBuffer:new q(null),texelSize:new q(new ye),radius:new q(.85)},blending:vt,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Bl,vertexShader:Pl}),this.fragmentShader=un(this.fragmentShader)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}set supportBuffer(e){this.uniforms.supportBuffer.value=e}get radius(){return this.uniforms.radius.value}set radius(e){this.uniforms.radius.value=e}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}},Ol=new ga,at=null;function Nl(){if(at===null){const e=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),t=new Float32Array([0,0,2,0,0,2]);at=new Sa,at.setAttribute!==void 0?(at.setAttribute("position",new vn(e,3)),at.setAttribute("uv",new vn(t,2))):(at.addAttribute("position",new vn(e,3)),at.addAttribute("uv",new vn(t,2)))}return at}var Ae=class vs{constructor(t="Pass",n=new qn,i=Ol){this.name=t,this.renderer=null,this.scene=n,this.camera=i,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(t){if(this.rtt===t){const n=this.fullscreenMaterial;n!==null&&(n.needsUpdate=!0),this.rtt=!t}}set mainScene(t){}set mainCamera(t){}setRenderer(t){this.renderer=t}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(t){let n=this.screen;n!==null?n.material=t:(n=new gr(Nl(),t),n.frustumCulled=!1,this.scene===null&&(this.scene=new qn),this.scene.add(n),this.screen=n)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(t){this.fullscreenMaterial=t}getDepthTexture(){return null}setDepthTexture(t,n=Pt){}render(t,n,i,s,o){throw new Error("Render method not implemented!")}setSize(t,n){}initialize(t,n,i){}dispose(){for(const t of Object.keys(this)){const n=this[t];(n instanceof Le||n instanceof Er||n instanceof ui||n instanceof vs)&&this[t].dispose()}}},ps=class extends Ae{constructor(e,t=!0){super("CopyPass"),this.fullscreenMaterial=new ds,this.needsSwap=!1,this.renderTarget=e,e===void 0&&(this.renderTarget=new Le(1,1,{minFilter:dt,magFilter:dt,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=t}get resize(){return this.autoResize}set resize(e){this.autoResize=e}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(e){this.autoResize=e}render(e,t,n,i,s){this.fullscreenMaterial.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){this.autoResize&&this.renderTarget.setSize(e,t)}initialize(e,t,n){n!==void 0&&(this.renderTarget.texture.type=n,n!==xt?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":Bt(e)===me&&ht(this.renderTarget.texture,me))}},zl=class extends Ae{constructor(e,{minLuminance:t=.01,adaptationRate:n=1}={}){super("AdaptiveLuminancePass"),this.fullscreenMaterial=new dl,this.needsSwap=!1,this.renderTargetPrevious=new Le(1,1,{minFilter:It,magFilter:It,depthBuffer:!1}),this.renderTargetPrevious.texture.name="Luminance.Previous";const i=this.fullscreenMaterial;i.luminanceBuffer0=this.renderTargetPrevious.texture,i.luminanceBuffer1=e,i.minLuminance=t,i.adaptationRate=n,this.renderTargetAdapted=this.renderTargetPrevious.clone(),this.renderTargetAdapted.texture.name="Luminance.Adapted",this.copyPass=new ps(this.renderTargetPrevious,!1)}get texture(){return this.renderTargetAdapted.texture}getTexture(){return this.renderTargetAdapted.texture}set mipLevel1x1(e){this.fullscreenMaterial.mipLevel1x1=e}get adaptationRate(){return this.fullscreenMaterial.adaptationRate}set adaptationRate(e){this.fullscreenMaterial.adaptationRate=e}render(e,t,n,i,s){this.fullscreenMaterial.deltaTime=i,e.setRenderTarget(this.renderToScreen?null:this.renderTargetAdapted),e.render(this.scene,this.camera),this.copyPass.render(e,this.renderTargetAdapted)}},Ll=class extends Ae{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(e,t,n,i,s){const o=e.state.buffers.stencil;o.setLocked(!1),o.setTest(!1)}},fr=new yr,ms=class extends Ae{constructor(e=!0,t=!0,n=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=e,this.depth=t,this.stencil=n,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(e,t,n){this.color=e,this.depth=t,this.stencil=n}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(e){this.overrideClearColor=e}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(e){this.overrideClearAlpha=e}render(e,t,n,i,s){const o=this.overrideClearColor,l=this.overrideClearAlpha,f=e.getClearAlpha(),c=o!==null,h=l>=0;c?(e.getClearColor(fr),e.setClearColor(o,h?l:f)):h&&e.setClearAlpha(l),e.setRenderTarget(this.renderToScreen?null:t),e.clear(this.color,this.depth,this.stencil),c?e.setClearColor(fr,f):h&&e.setClearAlpha(f)}},gs=class extends Ae{constructor(e,t,n=null){super("RenderPass",e,t),this.needsSwap=!1,this.clearPass=new ms,this.overrideMaterialManager=n===null?null:new dr(n),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(e){this.scene=e}set mainCamera(e){this.camera=e}get renderToScreen(){return super.renderToScreen}set renderToScreen(e){super.renderToScreen=e,this.clearPass.renderToScreen=e}get overrideMaterial(){const e=this.overrideMaterialManager;return e!==null?e.material:null}set overrideMaterial(e){const t=this.overrideMaterialManager;e!==null?t!==null?t.setMaterial(e):this.overrideMaterialManager=new dr(e):t!==null&&(t.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(e){this.overrideMaterial=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getSelection(){return this.selection}setSelection(e){this.selection=e}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(e){this.ignoreBackground=e}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(e){this.skipShadowMapUpdate=e}getClearPass(){return this.clearPass}render(e,t,n,i,s){const o=this.scene,l=this.camera,f=this.selection,c=l.layers.mask,h=o.background,m=e.shadowMap.autoUpdate,S=this.renderToScreen?null:t;f!==null&&l.layers.set(f.getLayer()),this.skipShadowMapUpdate&&(e.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(o.background=null),this.clearPass.enabled&&this.clearPass.render(e,t),e.setRenderTarget(S),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(e,o,l):e.render(o,l),l.layers.mask=c,o.background=h,e.shadowMap.autoUpdate=m}},Fl=class extends Ae{constructor({normalBuffer:e=null,resolutionScale:t=.5,width:n=Se.AUTO_SIZE,height:i=Se.AUTO_SIZE,resolutionX:s=n,resolutionY:o=i}={}){super("DepthDownsamplingPass");const l=new wl;l.normalBuffer=e,this.fullscreenMaterial=l,this.needsDepthTexture=!0,this.needsSwap=!1,this.renderTarget=new Le(1,1,{minFilter:It,magFilter:It,depthBuffer:!1,type:_t}),this.renderTarget.texture.name="DepthDownsamplingPass.Target",this.renderTarget.texture.generateMipmaps=!1;const f=this.resolution=new Se(this,s,o,t);f.addEventListener("change",c=>this.setSize(f.baseWidth,f.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}setDepthTexture(e,t=Pt){this.fullscreenMaterial.depthBuffer=e,this.fullscreenMaterial.depthPacking=t}render(e,t,n,i,s){e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){const n=this.resolution;n.setBaseSize(e,t),this.renderTarget.setSize(n.width,n.height),this.fullscreenMaterial.setSize(e,t)}initialize(e,t,n){const i=e.getContext();if(!(i.getExtension("EXT_color_buffer_float")||i.getExtension("EXT_color_buffer_half_float")))throw new Error("Rendering to float texture is not supported.")}};function hr(e,t,n){for(const i of t){const s="$1"+e+i.charAt(0).toUpperCase()+i.slice(1),o=new RegExp("([^\\.])(\\b"+i+"\\b)","g");for(const l of n.entries())l[1]!==null&&n.set(l[0],l[1].replace(o,s))}}function kl(e,t,n){let i=t.getFragmentShader(),s=t.getVertexShader();const o=i!==void 0&&/mainImage/.test(i),l=i!==void 0&&/mainUv/.test(i);if(n.attributes|=t.getAttributes(),i===void 0)throw new Error(`Missing fragment shader (${t.name})`);if(l&&n.attributes&Ge.CONVOLUTION)throw new Error(`Effects that transform UVs are incompatible with convolution effects (${t.name})`);if(!o&&!l)throw new Error(`Could not find mainImage or mainUv function (${t.name})`);{const f=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,c=n.shaderParts;let h=c.get(J.FRAGMENT_HEAD)||"",m=c.get(J.FRAGMENT_MAIN_UV)||"",S=c.get(J.FRAGMENT_MAIN_IMAGE)||"",w=c.get(J.VERTEX_HEAD)||"",U=c.get(J.VERTEX_MAIN_SUPPORT)||"";const C=new Set,B=new Set;if(l&&(m+=`	${e}MainUv(UV);
`,n.uvTransformation=!0),s!==null&&/mainSupport/.test(s)){const E=/mainSupport *\([\w\s]*?uv\s*?\)/.test(s);U+=`	${e}MainSupport(`,U+=E?`vUv);
`:`);
`;for(const g of s.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const y of g[1].split(/\s*,\s*/))n.varyings.add(y),C.add(y),B.add(y);for(const g of s.matchAll(f))B.add(g[1])}for(const E of i.matchAll(f))B.add(E[1]);for(const E of t.defines.keys())B.add(E.replace(/\([\w\s,]*\)/g,""));for(const E of t.uniforms.keys())B.add(E);B.delete("while"),B.delete("for"),B.delete("if"),t.uniforms.forEach((E,g)=>n.uniforms.set(e+g.charAt(0).toUpperCase()+g.slice(1),E)),t.defines.forEach((E,g)=>n.defines.set(e+g.charAt(0).toUpperCase()+g.slice(1),E));const A=new Map([["fragment",i],["vertex",s]]);hr(e,B,n.defines),hr(e,B,A),i=A.get("fragment"),s=A.get("vertex");const P=t.blendMode;if(n.blendModes.set(P.blendFunction,P),o){t.inputColorSpace!==null&&t.inputColorSpace!==n.colorSpace&&(S+=t.inputColorSpace===me?`color0 = LinearTosRGB(color0);
	`:`color0 = sRGBToLinear(color0);
	`),t.outputColorSpace!==cs?n.colorSpace=t.outputColorSpace:t.inputColorSpace!==null&&(n.colorSpace=t.inputColorSpace);const E=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;S+=`${e}MainImage(color0, UV, `,n.attributes&Ge.DEPTH&&E.test(i)&&(S+="depth, ",n.readDepth=!0),S+=`color1);
	`;const g=e+"BlendOpacity";n.uniforms.set(g,P.opacity),S+=`color0 = blend${P.blendFunction}(color0, color1, ${g});

	`,h+=`uniform float ${g};

`}if(h+=i+`
`,s!==null&&(w+=s+`
`),c.set(J.FRAGMENT_HEAD,h),c.set(J.FRAGMENT_MAIN_UV,m),c.set(J.FRAGMENT_MAIN_IMAGE,S),c.set(J.VERTEX_HEAD,w),c.set(J.VERTEX_MAIN_SUPPORT,U),t.extensions!==null)for(const E of t.extensions)n.extensions.add(E)}}var Hl=class extends Ae{constructor(e,...t){super("EffectPass"),this.fullscreenMaterial=new Il(null,null,null,e),this.listener=n=>this.handleEvent(n),this.effects=[],this.setEffects(t),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(e){for(const t of this.effects)t.mainScene=e}set mainCamera(e){this.fullscreenMaterial.copyCameraSettings(e);for(const t of this.effects)t.mainCamera=e}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(e){this.fullscreenMaterial.encodeOutput=e}get dithering(){return this.fullscreenMaterial.dithering}set dithering(e){const t=this.fullscreenMaterial;t.dithering=e,t.needsUpdate=!0}setEffects(e){for(const t of this.effects)t.removeEventListener("change",this.listener);this.effects=e.sort((t,n)=>n.attributes-t.attributes);for(const t of this.effects)t.addEventListener("change",this.listener)}updateMaterial(){const e=new Xl;let t=0;for(const l of this.effects)if(l.blendMode.blendFunction===X.DST)e.attributes|=l.getAttributes()&Ge.DEPTH;else{if(e.attributes&l.getAttributes()&Ge.CONVOLUTION)throw new Error(`Convolution effects cannot be merged (${l.name})`);kl("e"+t++,l,e)}let n=e.shaderParts.get(J.FRAGMENT_HEAD),i=e.shaderParts.get(J.FRAGMENT_MAIN_IMAGE),s=e.shaderParts.get(J.FRAGMENT_MAIN_UV);const o=/\bblend\b/g;for(const l of e.blendModes.values())n+=l.getShaderCode().replace(o,`blend${l.blendFunction}`)+`
`;e.attributes&Ge.DEPTH?(e.readDepth&&(i=`float depth = readDepth(UV);

	`+i),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,e.colorSpace===me&&(i+=`color0 = sRGBToLinear(color0);
	`),e.uvTransformation?(s=`vec2 transformedUv = vUv;
`+s,e.defines.set("UV","transformedUv")):e.defines.set("UV","vUv"),e.shaderParts.set(J.FRAGMENT_HEAD,n),e.shaderParts.set(J.FRAGMENT_MAIN_IMAGE,i),e.shaderParts.set(J.FRAGMENT_MAIN_UV,s);for(const[l,f]of e.shaderParts)f!==null&&e.shaderParts.set(l,f.trim().replace(/^#/,`
#`));this.skipRendering=t===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(e)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(e,t=Pt){this.fullscreenMaterial.depthBuffer=e,this.fullscreenMaterial.depthPacking=t;for(const n of this.effects)n.setDepthTexture(e,t)}render(e,t,n,i,s){for(const o of this.effects)o.update(e,t,i);if(!this.skipRendering||this.renderToScreen){const o=this.fullscreenMaterial;o.inputBuffer=t.texture,o.time+=i*this.timeScale,e.setRenderTarget(this.renderToScreen?null:n),e.render(this.scene,this.camera)}}setSize(e,t){this.fullscreenMaterial.setSize(e,t);for(const n of this.effects)n.setSize(e,t)}initialize(e,t,n){this.renderer=e;for(const i of this.effects)i.initialize(e,t,n);this.updateMaterial(),n!==void 0&&n!==xt&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const e of this.effects)e.removeEventListener("change",this.listener),e.dispose()}handleEvent(e){switch(e.type){case"change":this.recompile();break}}},Gl=class extends Ae{constructor({kernelSize:e=Ui.MEDIUM,resolutionScale:t=.5,width:n=Se.AUTO_SIZE,height:i=Se.AUTO_SIZE,resolutionX:s=n,resolutionY:o=i}={}){super("KawaseBlurPass"),this.renderTargetA=new Le(1,1,{depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";const l=this.resolution=new Se(this,s,o,t);l.addEventListener("change",f=>this.setSize(l.baseWidth,l.baseHeight)),this._blurMaterial=new _l,this._blurMaterial.kernelSize=e,this.copyMaterial=new ds}getResolution(){return this.resolution}get blurMaterial(){return this._blurMaterial}set blurMaterial(e){this._blurMaterial=e}get dithering(){return this.copyMaterial.dithering}set dithering(e){this.copyMaterial.dithering=e}get kernelSize(){return this.blurMaterial.kernelSize}set kernelSize(e){this.blurMaterial.kernelSize=e}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get scale(){return this.blurMaterial.scale}set scale(e){this.blurMaterial.scale=e}getScale(){return this.blurMaterial.scale}setScale(e){this.blurMaterial.scale=e}getKernelSize(){return this.kernelSize}setKernelSize(e){this.kernelSize=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,n,i,s){const o=this.scene,l=this.camera,f=this.renderTargetA,c=this.renderTargetB,h=this.blurMaterial,m=h.kernelSequence;let S=t;this.fullscreenMaterial=h;for(let w=0,U=m.length;w<U;++w){const C=w&1?c:f;h.kernel=m[w],h.inputBuffer=S.texture,e.setRenderTarget(C),e.render(o,l),S=C}this.fullscreenMaterial=this.copyMaterial,this.copyMaterial.inputBuffer=S.texture,e.setRenderTarget(this.renderToScreen?null:n),e.render(o,l)}setSize(e,t){const n=this.resolution;n.setBaseSize(e,t);const i=n.width,s=n.height;this.renderTargetA.setSize(i,s),this.renderTargetB.setSize(i,s),this.blurMaterial.setSize(e,t)}initialize(e,t,n){n!==void 0&&(this.renderTargetA.texture.type=n,this.renderTargetB.texture.type=n,n!==xt?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.copyMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):Bt(e)===me&&(ht(this.renderTargetA.texture,me),ht(this.renderTargetB.texture,me)))}static get AUTO_SIZE(){return Se.AUTO_SIZE}},Ss=class extends Ae{constructor({renderTarget:e,luminanceRange:t,colorOutput:n,resolutionScale:i=1,width:s=Se.AUTO_SIZE,height:o=Se.AUTO_SIZE,resolutionX:l=s,resolutionY:f=o}={}){super("LuminancePass"),this.fullscreenMaterial=new Cl(n,t),this.needsSwap=!1,this.renderTarget=e,this.renderTarget===void 0&&(this.renderTarget=new Le(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target");const c=this.resolution=new Se(this,l,f,i);c.addEventListener("change",h=>this.setSize(c.baseWidth,c.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(e,t,n,i,s){const o=this.fullscreenMaterial;o.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){const n=this.resolution;n.setBaseSize(e,t),this.renderTarget.setSize(n.width,n.height)}initialize(e,t,n){n!==void 0&&n!==xt&&(this.renderTarget.texture.type=n,this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},Vl=class extends Ae{constructor(e,t){super("MaskPass",e,t),this.needsSwap=!1,this.clearPass=new ms(!1,!1,!0),this.inverse=!1}set mainScene(e){this.scene=e}set mainCamera(e){this.camera=e}get inverted(){return this.inverse}set inverted(e){this.inverse=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(e){this.inverted=e}render(e,t,n,i,s){const o=e.getContext(),l=e.state.buffers,f=this.scene,c=this.camera,h=this.clearPass,m=this.inverted?0:1,S=1-m;l.color.setMask(!1),l.depth.setMask(!1),l.color.setLocked(!0),l.depth.setLocked(!0),l.stencil.setTest(!0),l.stencil.setOp(o.REPLACE,o.REPLACE,o.REPLACE),l.stencil.setFunc(o.ALWAYS,m,4294967295),l.stencil.setClear(S),l.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?h.render(e,null):(h.render(e,t),h.render(e,n))),this.renderToScreen?(e.setRenderTarget(null),e.render(f,c)):(e.setRenderTarget(t),e.render(f,c),e.setRenderTarget(n),e.render(f,c)),l.color.setLocked(!1),l.depth.setLocked(!1),l.stencil.setLocked(!1),l.stencil.setFunc(o.EQUAL,1,4294967295),l.stencil.setOp(o.KEEP,o.KEEP,o.KEEP),l.stencil.setLocked(!0)}},Zl=class extends Ae{constructor(){super("MipmapBlurPass"),this.needsSwap=!1,this.renderTarget=new Le(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Upsampling.Mipmap0",this.downsamplingMipmaps=[],this.upsamplingMipmaps=[],this.downsamplingMaterial=new Ml,this.upsamplingMaterial=new Dl,this.resolution=new ye}get texture(){return this.renderTarget.texture}get levels(){return this.downsamplingMipmaps.length}set levels(e){if(this.levels!==e){const t=this.renderTarget;this.dispose(),this.downsamplingMipmaps=[],this.upsamplingMipmaps=[];for(let n=0;n<e;++n){const i=t.clone();i.texture.name="Downsampling.Mipmap"+n,this.downsamplingMipmaps.push(i)}this.upsamplingMipmaps.push(t);for(let n=1,i=e-1;n<i;++n){const s=t.clone();s.texture.name="Upsampling.Mipmap"+n,this.upsamplingMipmaps.push(s)}this.setSize(this.resolution.x,this.resolution.y)}}get radius(){return this.upsamplingMaterial.radius}set radius(e){this.upsamplingMaterial.radius=e}render(e,t,n,i,s){const{scene:o,camera:l}=this,{downsamplingMaterial:f,upsamplingMaterial:c}=this,{downsamplingMipmaps:h,upsamplingMipmaps:m}=this;let S=t;this.fullscreenMaterial=f;for(let w=0,U=h.length;w<U;++w){const C=h[w];f.setSize(S.width,S.height),f.inputBuffer=S.texture,e.setRenderTarget(C),e.render(o,l),S=C}this.fullscreenMaterial=c;for(let w=m.length-1;w>=0;--w){const U=m[w];c.setSize(S.width,S.height),c.inputBuffer=S.texture,c.supportBuffer=h[w].texture,e.setRenderTarget(U),e.render(o,l),S=U}}setSize(e,t){const n=this.resolution;n.set(e,t);let i=n.width,s=n.height;for(let o=0,l=this.downsamplingMipmaps.length;o<l;++o)i=Math.round(i*.5),s=Math.round(s*.5),this.downsamplingMipmaps[o].setSize(i,s),o<this.upsamplingMipmaps.length&&this.upsamplingMipmaps[o].setSize(i,s)}initialize(e,t,n){if(n!==void 0){const i=this.downsamplingMipmaps.concat(this.upsamplingMipmaps);for(const s of i)s.texture.type=n;if(n!==xt)this.downsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.upsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1";else if(Bt(e)===me)for(const s of i)ht(s.texture,me)}}dispose(){super.dispose();for(const e of this.downsamplingMipmaps.concat(this.upsamplingMipmaps))e.dispose()}},Wl=class extends Ae{constructor(e,t,{renderTarget:n,resolutionScale:i=1,width:s=Se.AUTO_SIZE,height:o=Se.AUTO_SIZE,resolutionX:l=s,resolutionY:f=o}={}){super("NormalPass"),this.needsSwap=!1,this.renderPass=new gs(e,t,new ua);const c=this.renderPass;c.ignoreBackground=!0,c.skipShadowMapUpdate=!0;const h=c.getClearPass();h.overrideClearColor=new yr(7829503),h.overrideClearAlpha=1,this.renderTarget=n,this.renderTarget===void 0&&(this.renderTarget=new Le(1,1,{minFilter:It,magFilter:It}),this.renderTarget.texture.name="NormalPass.Target");const m=this.resolution=new Se(this,l,f,i);m.addEventListener("change",S=>this.setSize(m.baseWidth,m.baseHeight))}set mainScene(e){this.renderPass.mainScene=e}set mainCamera(e){this.renderPass.mainCamera=e}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,n,i,s){const o=this.renderToScreen?null:this.renderTarget;this.renderPass.render(e,o,o)}setSize(e,t){const n=this.resolution;n.setBaseSize(e,t),this.renderTarget.setSize(n.width,n.height)}},$n=1/1e3,$l=1e3,jl=class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(e){typeof document<"u"&&document.hidden!==void 0&&(e?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=e)}get delta(){return this._delta*$n}get fixedDelta(){return this._fixedDelta*$n}set fixedDelta(e){this._fixedDelta=e*$l}get elapsed(){return this._elapsed*$n}update(e){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(e!==void 0?e:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}handleEvent(e){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},ql=class{constructor(t=null,{depthBuffer:n=!0,stencilBuffer:i=!1,multisampling:s=0,frameBufferType:o}={}){this.renderer=null,this.inputBuffer=this.createBuffer(n,i,o,s),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new ps,this.depthTexture=null,this.passes=[],this.timer=new jl,this.autoRenderToScreen=!0,this.setRenderer(t)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(t){const n=this.inputBuffer,i=this.multisampling;i>0&&t>0?(this.inputBuffer.samples=t,this.outputBuffer.samples=t,this.inputBuffer.dispose(),this.outputBuffer.dispose()):i!==t&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(n.depthBuffer,n.stencilBuffer,n.texture.type,t),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(t){if(this.renderer=t,t!==null){const n=t.getSize(new ye),i=t.getContext().getContextAttributes().alpha,s=this.inputBuffer.texture.type;s===xt&&Bt(t)===me&&(ht(this.inputBuffer.texture,me),ht(this.outputBuffer.texture,me),this.inputBuffer.dispose(),this.outputBuffer.dispose()),t.autoClear=!1,this.setSize(n.width,n.height);for(const o of this.passes)o.initialize(t,i,s)}}replaceRenderer(t,n=!0){const i=this.renderer,s=i.domElement.parentNode;return this.setRenderer(t),n&&s!==null&&(s.removeChild(i.domElement),s.appendChild(t.domElement)),i}createDepthTexture(){const t=this.depthTexture=new ca;return this.inputBuffer.depthTexture=t,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(t.format=fa,t.type=ha):t.type=da,t}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const t of this.passes)t.setDepthTexture(null)}}createBuffer(t,n,i,s){const o=this.renderer,l=o===null?new ye:o.getDrawingBufferSize(new ye),f={minFilter:dt,magFilter:dt,stencilBuffer:n,depthBuffer:t,type:i},c=new Le(l.width,l.height,f);return s>0&&(c.ignoreDepthForMultisampleCopy=!1,c.samples=s),i===xt&&Bt(o)===me&&ht(c.texture,me),c.texture.name="EffectComposer.Buffer",c.texture.generateMipmaps=!1,c}setMainScene(t){for(const n of this.passes)n.mainScene=t}setMainCamera(t){for(const n of this.passes)n.mainCamera=t}addPass(t,n){const i=this.passes,s=this.renderer,o=s.getDrawingBufferSize(new ye),l=s.getContext().getContextAttributes().alpha,f=this.inputBuffer.texture.type;if(t.setRenderer(s),t.setSize(o.width,o.height),t.initialize(s,l,f),this.autoRenderToScreen&&(i.length>0&&(i[i.length-1].renderToScreen=!1),t.renderToScreen&&(this.autoRenderToScreen=!1)),n!==void 0?i.splice(n,0,t):i.push(t),this.autoRenderToScreen&&(i[i.length-1].renderToScreen=!0),t.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){const c=this.createDepthTexture();for(t of i)t.setDepthTexture(c)}else t.setDepthTexture(this.depthTexture)}removePass(t){const n=this.passes,i=n.indexOf(t);if(i!==-1&&n.splice(i,1).length>0){if(this.depthTexture!==null){const l=(c,h)=>c||h.needsDepthTexture;n.reduce(l,!1)||(t.getDepthTexture()===this.depthTexture&&t.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&i===n.length&&(t.renderToScreen=!1,n.length>0&&(n[n.length-1].renderToScreen=!0))}}removeAllPasses(){const t=this.passes;this.deleteDepthTexture(),t.length>0&&(this.autoRenderToScreen&&(t[t.length-1].renderToScreen=!1),this.passes=[])}render(t){const n=this.renderer,i=this.copyPass;let s=this.inputBuffer,o=this.outputBuffer,l=!1,f,c,h;t===void 0&&(this.timer.update(),t=this.timer.delta);for(const m of this.passes)m.enabled&&(m.render(n,s,o,t,l),m.needsSwap&&(l&&(i.renderToScreen=m.renderToScreen,f=n.getContext(),c=n.state.buffers.stencil,c.setFunc(f.NOTEQUAL,1,4294967295),i.render(n,s,o,t,l),c.setFunc(f.EQUAL,1,4294967295)),h=s,s=o,o=h),m instanceof Vl?l=!0:m instanceof Ll&&(l=!1))}setSize(t,n,i){const s=this.renderer,o=s.getSize(new ye);(t===void 0||n===void 0)&&(t=o.width,n=o.height),(o.width!==t||o.height!==n)&&s.setSize(t,n,i);const l=s.getDrawingBufferSize(new ye);this.inputBuffer.setSize(l.width,l.height),this.outputBuffer.setSize(l.width,l.height);for(const f of this.passes)f.setSize(l.width,l.height)}reset(){const t=this.timer.autoReset;this.dispose(),this.autoRenderToScreen=!0,this.timer.autoReset=t}dispose(){for(const t of this.passes)t.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose()}},Xl=class{constructor(){this.shaderParts=new Map([[J.FRAGMENT_HEAD,null],[J.FRAGMENT_MAIN_UV,null],[J.FRAGMENT_MAIN_IMAGE,null],[J.VERTEX_HEAD,null],[J.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=Ge.NONE,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=Nn}},jn=!1,dr=class{constructor(e=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(e),this.meshCount=0,this.replaceMaterial=t=>{if(t.isMesh){let n;if(t.material.flatShading)switch(t.material.side){case $t:n=this.materialsFlatShadedDoubleSide;break;case dn:n=this.materialsFlatShadedBackSide;break;default:n=this.materialsFlatShaded;break}else switch(t.material.side){case $t:n=this.materialsDoubleSide;break;case dn:n=this.materialsBackSide;break;default:n=this.materials;break}this.originalMaterials.set(t,t.material),t.isSkinnedMesh?t.material=n[2]:t.isInstancedMesh?t.material=n[1]:t.material=n[0],++this.meshCount}}}cloneMaterial(e){if(!(e instanceof qe))return e.clone();const t=e.uniforms,n=new Map;for(const s in t){const o=t[s].value;o.isRenderTargetTexture&&(t[s].value=null,n.set(s,o))}const i=e.clone();for(const s of n)t[s[0]].value=s[1],i.uniforms[s[0]].value=s[1];return i}setMaterial(e){if(this.disposeMaterials(),this.material=e,e!==null){const t=this.materials=[this.cloneMaterial(e),this.cloneMaterial(e),this.cloneMaterial(e)];for(const n of t)n.uniforms=Object.assign({},e.uniforms),n.side=va;t[2].skinning=!0,this.materialsBackSide=t.map(n=>{const i=this.cloneMaterial(n);return i.uniforms=Object.assign({},e.uniforms),i.side=dn,i}),this.materialsDoubleSide=t.map(n=>{const i=this.cloneMaterial(n);return i.uniforms=Object.assign({},e.uniforms),i.side=$t,i}),this.materialsFlatShaded=t.map(n=>{const i=this.cloneMaterial(n);return i.uniforms=Object.assign({},e.uniforms),i.flatShading=!0,i}),this.materialsFlatShadedBackSide=t.map(n=>{const i=this.cloneMaterial(n);return i.uniforms=Object.assign({},e.uniforms),i.flatShading=!0,i.side=dn,i}),this.materialsFlatShadedDoubleSide=t.map(n=>{const i=this.cloneMaterial(n);return i.uniforms=Object.assign({},e.uniforms),i.flatShading=!0,i.side=$t,i})}}render(e,t,n){const i=e.shadowMap.enabled;if(e.shadowMap.enabled=!1,jn){const s=this.originalMaterials;this.meshCount=0,t.traverse(this.replaceMaterial),e.render(t,n);for(const o of s)o[0].material=o[1];this.meshCount!==s.size&&s.clear()}else{const s=t.overrideMaterial;t.overrideMaterial=this.material,e.render(t,n),t.overrideMaterial=s}e.shadowMap.enabled=i}disposeMaterials(){if(this.material!==null){const e=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const t of e)t.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return jn}static set workaroundEnabled(e){jn=e}},ot=-1,Se=class extends ci{constructor(e,t=ot,n=ot,i=1){super(),this.resizable=e,this.baseSize=new ye(1,1),this.preferredSize=new ye(t,n),this.target=this.preferredSize,this.s=i,this.effectiveSize=new ye,this.addEventListener("change",()=>this.updateEffectiveSize()),this.updateEffectiveSize()}updateEffectiveSize(){const e=this.baseSize,t=this.preferredSize,n=this.effectiveSize,i=this.scale;t.width!==ot?n.width=t.width:t.height!==ot?n.width=Math.round(t.height*(e.width/Math.max(e.height,1))):n.width=Math.round(e.width*i),t.height!==ot?n.height=t.height:t.width!==ot?n.height=Math.round(t.width/Math.max(e.width/Math.max(e.height,1),1)):n.height=Math.round(e.height*i)}get width(){return this.effectiveSize.width}set width(e){this.preferredWidth=e}get height(){return this.effectiveSize.height}set height(e){this.preferredHeight=e}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(e){this.s!==e&&(this.s=e,this.preferredSize.setScalar(ot),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(e){this.scale=e}get baseWidth(){return this.baseSize.width}set baseWidth(e){this.baseSize.width!==e&&(this.baseSize.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(e){this.baseWidth=e}get baseHeight(){return this.baseSize.height}set baseHeight(e){this.baseSize.height!==e&&(this.baseSize.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(e){this.baseHeight=e}setBaseSize(e,t){(this.baseSize.width!==e||this.baseSize.height!==t)&&(this.baseSize.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(e){this.preferredSize.width!==e&&(this.preferredSize.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(e){this.preferredWidth=e}get preferredHeight(){return this.preferredSize.height}set preferredHeight(e){this.preferredSize.height!==e&&(this.preferredSize.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(e){this.preferredHeight=e}setPreferredSize(e,t){(this.preferredSize.width!==e||this.preferredSize.height!==t)&&(this.preferredSize.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(e){this.s=e.scale,this.baseSize.set(e.baseWidth,e.baseHeight),this.preferredSize.set(e.preferredWidth,e.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return ot}},Ql="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y,opacity);}",Kl="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,min(y.a,opacity));}",Yl="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y)*0.5,opacity);}",Jl="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.rg,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",eu="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(step(0.0,y)*(1.0-min(vec4(1.0),(1.0-x)/y)),vec4(1.0),step(1.0,x));return mix(x,z,opacity);}",tu="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=step(0.0,x)*mix(min(vec4(1.0),x/max(1.0-y,1e-9)),vec4(1.0),step(1.0,y));return mix(x,z,opacity);}",nu="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x,y),opacity);}",iu="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,abs(x-y),opacity);}",ru="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x/max(y,1e-12),opacity);}",su="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y-2.0*x*y),opacity);}",au="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 a=min(x,1.0),b=min(y,1.0);vec4 z=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,y));return mix(x,z,opacity);}",ou="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,step(1.0,x+y),opacity);}",lu="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.r,xHSL.gb));return vec4(mix(x.rgb,z,opacity),y.a);}",uu="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-y,opacity);}",cu="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y*(1.0-x),opacity);}",fu="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x,y),opacity);}",hu="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(y+x-1.0,0.0,1.0),opacity);}",du="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x+y,1.0),opacity);}",vu="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(2.0*y+x-1.0,0.0,1.0),opacity);}",pu="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.rg,yHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",mu="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x*y,opacity);}",gu="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-abs(1.0-x-y),opacity);}",Su="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,opacity);}",_u="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(2.0*y*x,1.0-2.0*(1.0-y)*(1.0-x),step(0.5,x));return mix(x,z,opacity);}",xu="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 z=mix(mix(y2,x,step(0.5*x,y)),max(vec4(0.0),y2-1.0),step(x,(y2-1.0)));return mix(x,z,opacity);}",yu="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(min(x*x/max(1.0-y,1e-12),1.0),y,step(1.0,y));return mix(x,z,opacity);}",Eu="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.r,yHSL.g,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",wu="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y-min(x*y,1.0),opacity);}",bu="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 w=step(0.5,y);vec4 z=mix(x-(1.0-y2)*x*(1.0-x),mix(x+(y2-1.0)*(sqrt(x)-x),x+(y2-1.0)*x*((16.0*x-12.0)*x+3.0),w*(1.0-step(0.25,x))),w);return mix(x,z,opacity);}",Tu="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y;}",Mu="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x+y-1.0,0.0),opacity);}",Ru="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(max(1.0-min((1.0-x)/(2.0*y),1.0),0.0),min(x/(2.0*(1.0-y)),1.0),step(0.5,y));return mix(x,z,opacity);}",Au=new Map([[X.ADD,Ql],[X.ALPHA,Kl],[X.AVERAGE,Yl],[X.COLOR,Jl],[X.COLOR_BURN,eu],[X.COLOR_DODGE,tu],[X.DARKEN,nu],[X.DIFFERENCE,iu],[X.DIVIDE,ru],[X.DST,null],[X.EXCLUSION,su],[X.HARD_LIGHT,au],[X.HARD_MIX,ou],[X.HUE,lu],[X.INVERT,uu],[X.INVERT_RGB,cu],[X.LIGHTEN,fu],[X.LINEAR_BURN,hu],[X.LINEAR_DODGE,du],[X.LINEAR_LIGHT,vu],[X.LUMINOSITY,pu],[X.MULTIPLY,mu],[X.NEGATION,gu],[X.NORMAL,Su],[X.OVERLAY,_u],[X.PIN_LIGHT,xu],[X.REFLECT,yu],[X.SATURATION,Eu],[X.SCREEN,wu],[X.SOFT_LIGHT,bu],[X.SRC,Tu],[X.SUBTRACT,Mu],[X.VIVID_LIGHT,Ru]]),Iu=class extends ci{constructor(e,t=1){super(),this._blendFunction=e,this.opacity=new q(t)}getOpacity(){return this.opacity.value}setOpacity(e){this.opacity.value=e}get blendFunction(){return this._blendFunction}set blendFunction(e){this._blendFunction=e,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(e){this.blendFunction=e}getShaderCode(){return Au.get(this.blendFunction)}},rn=class extends ci{constructor(e,t,{attributes:n=Ge.NONE,blendFunction:i=X.NORMAL,defines:s=new Map,uniforms:o=new Map,extensions:l=null,vertexShader:f=null}={}){super(),this.name=e,this.renderer=null,this.attributes=n,this.fragmentShader=t,this.vertexShader=f,this.defines=s,this.uniforms=o,this.extensions=l,this.blendMode=new Iu(i),this.blendMode.addEventListener("change",c=>this.setChanged()),this._inputColorSpace=Nn,this._outputColorSpace=cs}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(e){this._inputColorSpace=e,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e,this.setChanged()}set mainScene(e){}set mainCamera(e){}getName(){return this.name}setRenderer(e){this.renderer=e}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(e){this.attributes=e,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(e){this.fragmentShader=e,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(e){this.vertexShader=e,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(e,t=Pt){}update(e,t,n){}setSize(e,t){}initialize(e,t,n){}dispose(){for(const e of Object.keys(this)){const t=this[e];(t instanceof Le||t instanceof Er||t instanceof ui||t instanceof Ae)&&this[e].dispose()}}},Uu=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 texel=texture2D(map,uv);outputColor=vec4(texel.rgb*intensity,texel.a);}`,Cu=class extends rn{constructor({blendFunction:e=X.SCREEN,luminanceThreshold:t=.9,luminanceSmoothing:n=.025,mipmapBlur:i=!1,intensity:s=1,radius:o=.85,levels:l=8,kernelSize:f=Ui.LARGE,resolutionScale:c=.5,width:h=Se.AUTO_SIZE,height:m=Se.AUTO_SIZE,resolutionX:S=h,resolutionY:w=m}={}){super("BloomEffect",Uu,{blendFunction:e,uniforms:new Map([["map",new q(null)],["intensity",new q(s)]])}),this.renderTarget=new Le(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.blurPass=new Gl({kernelSize:f}),this.luminancePass=new Ss({colorOutput:!0}),this.luminanceMaterial.threshold=t,this.luminanceMaterial.smoothing=n,this.mipmapBlurPass=new Zl,this.mipmapBlurPass.enabled=i,this.mipmapBlurPass.radius=o,this.mipmapBlurPass.levels=l,this.uniforms.get("map").value=i?this.mipmapBlurPass.texture:this.renderTarget.texture;const U=this.resolution=new Se(this,S,w,c);U.addEventListener("change",C=>this.setSize(U.baseWidth,U.baseHeight))}get texture(){return this.mipmapBlurPass.enabled?this.mipmapBlurPass.texture:this.renderTarget.texture}getTexture(){return this.texture}getResolution(){return this.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get dithering(){return this.blurPass.dithering}set dithering(e){this.blurPass.dithering=e}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(e){this.blurPass.kernelSize=e}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(e){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(e){this.uniforms.get("intensity").value=e}getIntensity(){return this.intensity}setIntensity(e){this.intensity=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}update(e,t,n){const i=this.renderTarget,s=this.luminancePass;s.enabled?(s.render(e,t),this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(e,s.renderTarget):this.blurPass.render(e,s.renderTarget,i)):this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(e,t):this.blurPass.render(e,t,i)}setSize(e,t){const n=this.resolution;n.setBaseSize(e,t),this.renderTarget.setSize(n.width,n.height),this.blurPass.resolution.copy(n),this.luminancePass.setSize(e,t),this.mipmapBlurPass.setSize(e,t)}initialize(e,t,n){this.blurPass.initialize(e,t,n),this.luminancePass.initialize(e,t,n),this.mipmapBlurPass.initialize(e,t,n),n!==void 0&&(this.renderTarget.texture.type=n,Bt(e)===me&&ht(this.renderTarget.texture,me))}},Bu=`#ifdef RADIAL_MODULATION
uniform float modulationOffset;
#endif
varying float vActive;varying vec2 vUvR;varying vec2 vUvB;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 ra=inputColor.ra;vec2 ba=inputColor.ba;
#ifdef RADIAL_MODULATION
const vec2 center=vec2(0.5);float d=distance(uv,center)*2.0;d=max(d-modulationOffset,0.0);if(vActive>0.0&&d>0.0){ra=texture2D(inputBuffer,mix(uv,vUvR,d)).ra;ba=texture2D(inputBuffer,mix(uv,vUvB,d)).ba;}
#else
if(vActive>0.0){ra=texture2D(inputBuffer,vUvR).ra;ba=texture2D(inputBuffer,vUvB).ba;}
#endif
outputColor=vec4(ra.x,inputColor.g,ba.x,max(max(ra.y,ba.y),inputColor.a));}`,Pu="uniform vec2 offset;varying float vActive;varying vec2 vUvR;varying vec2 vUvB;void mainSupport(const in vec2 uv){vec2 shift=offset*vec2(1.0,aspect);vActive=(shift.x!=0.0||shift.y!=0.0)?1.0:0.0;vUvR=uv+shift;vUvB=uv-shift;}",Du=class extends rn{constructor({offset:e=new ye(.001,5e-4),radialModulation:t=!1,modulationOffset:n=.15}={}){super("ChromaticAberrationEffect",Bu,{vertexShader:Pu,attributes:Ge.CONVOLUTION,uniforms:new Map([["offset",new q(e)],["modulationOffset",new q(n)]])}),this.radialModulation=t}get offset(){return this.uniforms.get("offset").value}set offset(e){this.uniforms.get("offset").value=e}get radialModulation(){return this.defines.has("RADIAL_MODULATION")}set radialModulation(e){e?this.defines.set("RADIAL_MODULATION","1"):this.defines.delete("RADIAL_MODULATION"),this.setChanged()}get modulationOffset(){return this.uniforms.get("modulationOffset").value}set modulationOffset(e){this.uniforms.get("modulationOffset").value=e}getOffset(){return this.offset}setOffset(e){this.offset=e}},Ou=`#include <tonemapping_pars_fragment>
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
uniform float whitePoint;
#if TONE_MAPPING_MODE == 1 || TONE_MAPPING_MODE == 2
uniform float middleGrey;
#if TONE_MAPPING_MODE == 2
uniform lowp sampler2D luminanceBuffer;
#else
uniform float averageLuminance;
#endif
vec3 Reinhard2ToneMapping(vec3 color){color*=toneMappingExposure;float l=luminance(color);
#if TONE_MAPPING_MODE == 2
float lumAvg=unpackRGBAToFloat(texture2D(luminanceBuffer,vec2(0.5)));
#else
float lumAvg=averageLuminance;
#endif
float lumScaled=(l*middleGrey)/max(lumAvg,1e-6);float lumCompressed=lumScaled*(1.0+lumScaled/(whitePoint*whitePoint));lumCompressed/=(1.0+lumScaled);return clamp(lumCompressed*color,0.0,1.0);}
#elif TONE_MAPPING_MODE == 5
#define A 0.15
#define B 0.50
#define C 0.10
#define D 0.20
#define E 0.02
#define F 0.30
vec3 Uncharted2Helper(const in vec3 x){return((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}vec3 Uncharted2ToneMapping(vec3 color){color*=toneMappingExposure;return clamp(Uncharted2Helper(color)/Uncharted2Helper(vec3(whitePoint)),0.0,1.0);}
#endif
void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){
#if TONE_MAPPING_MODE == 1 || TONE_MAPPING_MODE == 2
outputColor=vec4(Reinhard2ToneMapping(inputColor.rgb),inputColor.a);
#elif TONE_MAPPING_MODE == 5
outputColor=vec4(Uncharted2ToneMapping(inputColor.rgb),inputColor.a);
#else
outputColor=vec4(toneMapping(inputColor.rgb),inputColor.a);
#endif
}`,Nu=class extends rn{constructor({blendFunction:e=X.SRC,adaptive:t=!1,mode:n=t?Ye.REINHARD2_ADAPTIVE:Ye.ACES_FILMIC,resolution:i=256,maxLuminance:s=4,whitePoint:o=s,middleGrey:l=.6,minLuminance:f=.01,averageLuminance:c=1,adaptationRate:h=1}={}){super("ToneMappingEffect",Ou,{blendFunction:e,uniforms:new Map([["luminanceBuffer",new q(null)],["maxLuminance",new q(s)],["whitePoint",new q(o)],["middleGrey",new q(l)],["averageLuminance",new q(c)]])}),this.renderTargetLuminance=new Le(1,1,{minFilter:pa,depthBuffer:!1}),this.renderTargetLuminance.texture.generateMipmaps=!0,this.renderTargetLuminance.texture.name="Luminance",this.luminancePass=new Ss({renderTarget:this.renderTargetLuminance}),this.adaptiveLuminancePass=new zl(this.luminancePass.texture,{minLuminance:f,adaptationRate:h}),this.uniforms.get("luminanceBuffer").value=this.adaptiveLuminancePass.texture,this.resolution=i,this.mode=n}get mode(){return Number(this.defines.get("TONE_MAPPING_MODE"))}set mode(e){if(this.mode!==e){switch(this.defines.clear(),this.defines.set("TONE_MAPPING_MODE",e.toFixed(0)),e){case Ye.REINHARD:this.defines.set("toneMapping(texel)","ReinhardToneMapping(texel)");break;case Ye.OPTIMIZED_CINEON:this.defines.set("toneMapping(texel)","OptimizedCineonToneMapping(texel)");break;case Ye.ACES_FILMIC:this.defines.set("toneMapping(texel)","ACESFilmicToneMapping(texel)");break;default:this.defines.set("toneMapping(texel)","texel");break}this.adaptiveLuminancePass.enabled=e===Ye.REINHARD2_ADAPTIVE,this.setChanged()}}getMode(){return this.mode}setMode(e){this.mode=e}get whitePoint(){return this.uniforms.get("whitePoint").value}set whitePoint(e){this.uniforms.get("whitePoint").value=e}get middleGrey(){return this.uniforms.get("middleGrey").value}set middleGrey(e){this.uniforms.get("middleGrey").value=e}get averageLuminance(){return this.uniforms.get("averageLuminance").value}set averageLuminance(e){this.uniforms.get("averageLuminance").value=e}get adaptiveLuminanceMaterial(){return this.adaptiveLuminancePass.fullscreenMaterial}getAdaptiveLuminanceMaterial(){return this.adaptiveLuminanceMaterial}get resolution(){return this.luminancePass.resolution.width}set resolution(e){const t=Math.max(0,Math.ceil(Math.log2(e))),n=Math.pow(2,t);this.luminancePass.resolution.setPreferredSize(n,n),this.adaptiveLuminanceMaterial.mipLevel1x1=t}getResolution(){return this.resolution}setResolution(e){this.resolution=e}get adaptive(){return this.mode===Ye.REINHARD2_ADAPTIVE}set adaptive(e){this.mode=e?Ye.REINHARD2_ADAPTIVE:Ye.REINHARD2}get adaptationRate(){return this.adaptiveLuminanceMaterial.adaptationRate}set adaptationRate(e){this.adaptiveLuminanceMaterial.adaptationRate=e}get distinction(){return console.warn(this.name,"distinction was removed."),1}set distinction(e){console.warn(this.name,"distinction was removed.")}update(e,t,n){this.adaptiveLuminancePass.enabled&&(this.luminancePass.render(e,t),this.adaptiveLuminancePass.render(e,null,null,n))}initialize(e,t,n){this.adaptiveLuminancePass.initialize(e,t,n)}};const zu=D.createContext(null),vr=e=>(e.getAttributes()&Ge.CONVOLUTION)===Ge.CONVOLUTION,Lu=Xn.memo(D.forwardRef(({children:e,camera:t,scene:n,resolutionScale:i,enabled:s=!0,renderPriority:o=1,autoClear:l=!0,depthBuffer:f,disableNormalPass:c,stencilBuffer:h,multisampling:m=8,frameBufferType:S=$e},w)=>{const{gl:U,scene:C,camera:B,size:A}=et(),P=n||C,E=t||B,[g,y,k]=D.useMemo(()=>{const F=Go(),G=new ql(U,{depthBuffer:f,stencilBuffer:h,multisampling:m>0&&F?m:0,frameBufferType:S});G.addPass(new gs(P,E));let N=null,W=null;return c||(W=new Wl(P,E),W.enabled=!1,G.addPass(W),i!==void 0&&F&&(N=new Fl({normalBuffer:W.texture,resolutionScale:i}),N.enabled=!1,G.addPass(N))),[G,W,N]},[E,U,f,h,m,S,P,c,i]);D.useEffect(()=>g?.setSize(A.width,A.height),[g,A]),_r((F,G)=>{if(s){const N=U.autoClear;U.autoClear=l,h&&!l&&U.clearStencil(),g.render(G),U.autoClear=N}},s?o:0);const z=D.useRef(null),Z=_a(z);D.useLayoutEffect(()=>{const F=[];if(z.current&&Z.current&&g){const G=Z.current.objects;for(let N=0;N<G.length;N++){const W=G[N];if(W instanceof rn){const fe=[W];if(!vr(W)){let de=null;for(;(de=G[N+1])instanceof rn&&!vr(de);)fe.push(de),N++}const he=new Hl(E,...fe);F.push(he)}else W instanceof Ae&&F.push(W)}for(const N of F)g?.addPass(N);y&&(y.enabled=!0),k&&(k.enabled=!0)}return()=>{for(const G of F)g?.removePass(G);y&&(y.enabled=!1),k&&(k.enabled=!1)}},[g,e,E,y,k,Z]);const L=D.useMemo(()=>({composer:g,normalPass:y,downSamplingPass:k,resolutionScale:i,camera:E,scene:P}),[g,y,k,i,E,P]);return D.useImperativeHandle(w,()=>g,[g]),K.jsx(zu.Provider,{value:L,children:K.jsx("group",{ref:z,children:e})})}));let Fu=0;const pr=new WeakMap,_s=(e,t)=>Xn.forwardRef(function({blendFunction:i=t?.blendFunction,opacity:s=t?.opacity,...o},l){let f=pr.get(e);if(!f){const m=`@react-three/postprocessing/${e.name}-${Fu++}`;xr({[m]:e}),pr.set(e,f=m)}const c=et(m=>m.camera),h=Xn.useMemo(()=>{var m,S;return[...(m=t?.args)!=null?m:[],...(S=o.args)!=null?S:[{...t,...o}]]},[JSON.stringify(o)]);return K.jsx(f,{camera:c,"blendMode-blendFunction":i,"blendMode-opacity-value":s,...o,ref:l,args:h})}),ku=_s(Cu,{blendFunction:X.ADD}),Hu=_s(Du),Gu=D.forwardRef(function({blendFunction:t,adaptive:n,mode:i,resolution:s,maxLuminance:o,whitePoint:l,middleGrey:f,minLuminance:c,averageLuminance:h,adaptationRate:m,...S},w){const U=D.useMemo(()=>new Nu({blendFunction:t,adaptive:n,mode:i,resolution:s,maxLuminance:o,whitePoint:l,middleGrey:f,minLuminance:c,averageLuminance:h,adaptationRate:m}),[t,n,i,s,o,l,f,c,h,m]);return D.useEffect(()=>{U.dispose()},[U]),K.jsx("primitive",{...S,ref:w,object:U,attributes:Ge.CONVOLUTION})}),Vu={encoding:Tr,files:["./enviroments/px.png","./enviroments/nx.png","./enviroments/py.png","./enviroments/ny.png","./enviroments/pz.png","./enviroments/nz.png"]},Zu={name:"directional_light",castShadow:!0,intensity:10,position:[1.9,3,1],penumbra:.5,color:"#fff"},Wu={offset:[5e-4,5e-4],blendFunction:X.SCREEN},$u={mipmapBlur:!0,intensity:1,luminanceThreshold:.7,luminanceSmoothing:.7,resolutionX:Se.AUTO_SIZE,resolutionY:Se.AUTO_SIZE,kernelSize:1,blendFunction:X.OVERLAY},ju={blendFunction:X.SCREEN,mode:3};function qu(e){const t=D.useRef(),{nodes:n,materials:i,animations:s}=Mr("models/moden.glb"),{actions:o}=xa(s,t);return D.useEffect(()=>{o.Logo_luzAction.play()},[]),K.jsx("group",{ref:t,...e,dispose:null,children:K.jsxs("group",{name:"Scene",children:[K.jsx("mesh",{name:"Logo_luz",castShadow:!0,receiveShadow:!0,geometry:n.Logo_luz.geometry,material:i.Material,position:[.845,.495,-.03],scale:.932}),K.jsxs("group",{name:"Cuerpo",position:[.354,.539,.003],scale:[.012,.033,.012],children:[K.jsx("mesh",{name:"Cubo015",castShadow:!0,receiveShadow:!0,geometry:n.Cubo015.geometry,material:i.Material}),K.jsx("mesh",{name:"Cubo015_1",castShadow:!0,receiveShadow:!0,geometry:n.Cubo015_1.geometry,material:i.white}),K.jsx("mesh",{name:"Cubo015_2",castShadow:!0,receiveShadow:!0,geometry:n.Cubo015_2.geometry,material:i.blackCristal}),K.jsx("mesh",{name:"Cubo015_3",castShadow:!0,receiveShadow:!0,geometry:n.Cubo015_3.geometry,material:i.gray}),K.jsx("mesh",{name:"Cubo015_4",castShadow:!0,receiveShadow:!0,geometry:n.Cubo015_4.geometry,material:i.yellow}),K.jsx("mesh",{name:"Cubo015_5",castShadow:!0,receiveShadow:!0,geometry:n.Cubo015_5.geometry,material:i.Upurple}),K.jsx("mesh",{name:"Cubo015_6",castShadow:!0,receiveShadow:!0,geometry:n.Cubo015_6.geometry,material:i.black}),K.jsx("mesh",{name:"Cubo015_7",castShadow:!0,receiveShadow:!0,geometry:n.Cubo015_7.geometry,material:i.Bronce}),K.jsx("mesh",{name:"Cubo015_8",castShadow:!0,receiveShadow:!0,geometry:n.Cubo015_8.geometry,material:i["Material.004"]}),K.jsx("mesh",{name:"Cubo015_9",castShadow:!0,receiveShadow:!0,geometry:n.Cubo015_9.geometry,material:i.Plata}),K.jsx("mesh",{name:"Cubo015_10",castShadow:!0,receiveShadow:!0,geometry:n.Cubo015_10.geometry,material:i.BotonON}),K.jsx("mesh",{name:"Cubo015_11",castShadow:!0,receiveShadow:!0,geometry:n.Cubo015_11.geometry,material:i["Material.001"]})]})]})})}Mr.preload("models/moden.gltf");function Xu(){let e={far:2e3,near:.1,fov:35,position:[0,.5,3],rotation:[0,0,0]};return K.jsxs(K.Fragment,{children:[K.jsx(D.Suspense,{fallback:null,children:K.jsxs(Lu,{multisampling:4,children:[K.jsx(Gu,{...ju}),K.jsx(ku,{...$u}),K.jsx(Hu,{...Wu})]})}),K.jsx(ya,{makeDefault:!0,...e}),K.jsx(fl,{...Vu}),K.jsx("pointLight",{...Zu,"shadow-bias":-3e-4,"shadow-mapSize":[512*6,512*6],"shadow-normalBias":.01}),K.jsx("ambientLight",{intensity:9.2,color:"#5d5d5d"}),K.jsx(D.Suspense,{children:K.jsx(Ho,{config:{mass:2,tension:500},snap:{mass:4,tension:1500},rotation:[.4,-2,0],polar:[-Math.PI/3,Math.PI/3],azimuth:[-Math.PI/1.4,Math.PI/2],children:K.jsx(qu,{position:[-.2,.2,0]})})})]})}const Ju=()=>K.jsx(Ea,{style:{height:"100%",width:"100%"},dpr:[.5,1.2],performance:{current:1,min:.1,max:1,debounce:200,regress:.5},shadows:!0,gl:{antialias:!1,alpha:!0,powerPreference:"high-performance",stencil:!1,depth:!1,toneMapping:wa,toneMappingExposure:.6,gammaOutput:!0,outputColorSpace:Tr},children:K.jsx(Xu,{})});export{Ju as default};
